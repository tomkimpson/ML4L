	%% Copernicus Publications Manuscript Preparation Template for LaTeX Submissions
%% ---------------------------------
%% This template should be used for copernicus.cls
%% The class file and some style files are bundled in the Copernicus Latex Package, which can be downloaded from the different journal webpages.
%% For further assistance please contact Copernicus Publications at: production@copernicus.org
%% https://publications.copernicus.org/for_authors/manuscript_preparation.html


%% Please use the following documentclass and journal abbreviations for preprints and final revised papers.

%% 2-column papers and preprints
\documentclass[hess, twostagejnl]{copernicus}

%\documentclass[tc,manuscript]{copernicus}

%% Journal abbreviations (please use the same for preprints and final revised papers)


% Advances in Geosciences (adgeo)
% Advances in Radio Science (ars)
% Advances in Science and Research (asr)
% Advances in Statistical Climatology, Meteorology and Oceanography (ascmo)
% Annales Geophysicae (angeo)
% Archives Animal Breeding (aab)
% Atmospheric Chemistry and Physics (acp)
% Atmospheric Measurement Techniques (amt)
% Biogeosciences (bg)
% Climate of the Past (cp)
% DEUQUA Special Publications (deuquasp)
% Drinking Water Engineering and Science (dwes)
% Earth Surface Dynamics (esurf)
% Earth System Dynamics (esd)
% Earth System Science Data (essd)
% E&G Quaternary Science Journal (egqsj)
% EGUsphere (egusphere) | This is only for EGUsphere preprints submitted without relation to an EGU journal.
% European Journal of Mineralogy (ejm)
% Fossil Record (fr)
% Geochronology (gchron)
% Geographica Helvetica (gh)
% Geoscience Communication (gc)
% Geoscientific Instrumentation, Methods and Data Systems (gi)
% Geoscientific Model Development (gmd)
% History of Geo- and Space Sciences (hgss)
% Hydrology and Earth System Sciences (hess)
% Journal of Bone and Joint Infection (jbji)
% Journal of Micropalaeontology (jm)
% Journal of Sensors and Sensor Systems (jsss)
% Magnetic Resonance (mr)
% Mechanical Sciences (ms)
% Natural Hazards and Earth System Sciences (nhess)
% Nonlinear Processes in Geophysics (npg)
% Ocean Science (os)
% Polarforschung - Journal of the German Society for Polar Research (polf)
% Primate Biology (pb)
% Proceedings of the International Association of Hydrological Sciences (piahs)
% Safety of Nuclear Waste Disposal (sand)
% Scientific Drilling (sd)
% SOIL (soil)
% Solid Earth (se)
% State of the Planet (sp)
% The Cryosphere (tc)
% Weather and Climate Dynamics (wcd)
% Web Ecology (we)
% Wind Energy Science (wes)


%% \usepackage commands included in the copernicus.cls:
%\usepackage[german, english]{babel}
%\usepackage{tabularx}
%\usepackage{cancel}
%\usepackage{multirow}
%\usepackage{supertabular}
%\usepackage{algorithmic}
%\usepackage{algorithm}
%\usepackage{amsthm}
%\usepackage{float}
%\usepackage{subfig}
%\usepackage{rotating}



%Author added
\graphicspath{{images/}}
\usepackage{subcaption}
\usepackage{color,soul}
\usepackage{booktabs}

\begin{document}

\title{Deep learning for quality control of surface physiographic fields using satellite Earth observations}


% \Author[affil]{given_name}{surname}

\Author[1]{Tom}{Kimpson}
\Author[2]{Margarita}{Choulga}
\Author[2]{Matthew}{Chantry}
\Author[2]{Gianpaolo}{Balsamo}
\Author[2]{Souhail}{Boussetta}
\Author[2]{Peter}{Dueben}
\Author[1]{Tim}{Palmer}

\affil[1]{Department of Physics, University of Oxford, Oxford, UK}
\affil[2]{Research Department, European Centre for Medium-Range Weather Forecasts (ECMWF), Reading, UK}

%% The [] brackets identify the author with the corresponding affiliation. 1, 2, 3, etc. should be inserted.

%% If an author is deceased, please mark the respective author name(s) with a dagger, e.g. "\Author[2,$\dag$]{Anton}{Smith}", and add a further "\affil[$\dag$]{deceased, 1 July 2019}".

%% If authors contributed equally, please mark the respective author names with an asterisk, e.g. "\Author[2,*]{Anton}{Smith}" and "\Author[3,*]{Bradley}{Miller}" and add a further affiliation: "\affil[*]{These authors contributed equally to this work.}".


\correspondence{Tom Kimpson (tom.kimpson@physics.ox.ac.uk)}

\runningtitle{VESPER}

\runningauthor{Kimpson et al.}



\received{}
\pubdiscuss{} %% only important for two-stage journals
\revised{}
\accepted{}
\published{}

%% These dates will be inserted by Copernicus Publications during the typesetting process.


\firstpage{1}

\maketitle



\begin{abstract}
About 2/3 of all densely populated areas (i.e. at least 300 inhabitants per km$^2$) around the globe are situated within a 9 km radius of a permanent waterbody (i.e. inland water or sea/ocean coast), since inland water sustains the vast majority of human activities. Water bodies exchange mass and energy with the atmosphere and need to be accurately simulated in numerical weather prediction and climate modelling as they strongly influence the lower boundary conditions such as skin temperatures, turbulent latent and sensible heat fluxes and moisture availability near the surface. All the non-ocean water (resolved and sub-grid lakes and coastal waters) are represented in the Integrated Forecasting System (IFS) of the European Centre for Medium-Range Weather Forecasts (ECMWF) model, by the Fresh-water Lake (FLake) parametrisation, which treats $\sim$ 1/3 of the land. It is a continuous enterprise to update the surface parametrization schemes and their input fields to better represent small-scale processes. It is, however, difficult to quickly determine both the accuracy of an updated parametrisation, and the added value gained for the purposes of numerical modelling. The aim of our work is to quickly and automatically assess the benefits of an updated lake parametrisation making use of a neural network regression model trained to simulate satellite observed surface skin temperatures. In order to rapidly assess accuracy of new surface physiography fields and if their use in the model increase predictability a neural network regression model (further in the text referred as VESPER) that can learn the mapping between a set of features x and targets y is constructed. In this case the features are the atmospheric and surface model fields (such as 2 metre temperature from ERA5 reanalysis) and the surface physiographic fields (such as orography and vegetation cover used to produce ERA5 reanalysis), see Table 1 for the full list of variables used. The target is the satellite land surface temperature (skin temperature from MODIS Aqua Day MYD11A1 v006 collection). VESPER can then make predictions about the skin temperature given a set of input variables (i.e. atmospheric and surface model fields, and surface physiographic fields). In turn, these predictions can then be compared against observations (i.e. satellite skin temperature). We deploy this tool to determine the accuracy of recent upgrades to the FLake parametrisation, namely the improved permanent lake cover and the capacity to represent seasonally varying water bodies (i.e. ephemeral lakes). We show that for grid-cells where the lake fields have been updated, the prediction accuracy in the land surface temperature improves by 0.45 K on average, whilst for the subset of points where the lakes have been exchanged for bare ground (or vice versa) the improvement is 1.12 K. We also show that updates to the glacier cover improve further the prediction accuracy by 0.14 K. The inclusion of seasonal water is shown to be particularly effective for grid points which are highly time variable, generally improving the simulation accuracy by $\sim$1 K. The neural network regression model has proven to be useful and easily adaptable to assess unforeseen impacts of ancillary datasets, also detecting inappropriate changes of high vegetation to bare ground, which would lead to decreased the skin temperature simulation accuracy by 0.49 K, proving to be a valuable support to model development.
\end{abstract}


%\copyrightstatement{TEXT} %% This section is optional and can be used for copyright transfers.


%\introduction  %% \introduction[modified heading if necessary]
\section{Introduction}
\noindent Globally, there are $\sim$ 117 million lakes - defined as inland water bodies without lateral movement of water - making up around 3.7$\%$ of the Earth's land surface \citep{Verpoorter2014}. Their distribution is highly anisotropic, with the majority of lakes located between $45-75^{\circ}$N in the Boreal and Arctic regions. Lakes are highly important from the perspective of both numerical weather prediction and climate modelling as part of the EC-Earth model. For the latter, lakes generally influence the global carbon cycle as both sinks and sources of greenhouse gases; the majority of lakes are net heterotrophic, over saturated with CO$_2$ as a result of in lake respiration and so emit carbon into the atmosphere \citep{Pace2005,Tranvik2009}.  Total CO$_2$ emission from lakes is estimated at $1.25 - 2.30$ Pg of CO2-equivalents annually \citep{DelSontro2018}, nearly $20 \%$ of global CO$_2$ fossil fuel emissions, whilst lakes account for 9-24 $\%$  of CH$_4$ emissions, the second largest natural source after wetlands \citep{Saunois2020}. These rates of greenhouse gas emission are expected to rise further if the eutrophication of the Earth's lentic systems continues. With regards to weather, freezing and melting of the lake surface modifies the radiative and conductive properties and consequently affects the heat (latent, sensible) exchange and surface energy balance \citep{Huang2019,Peng2020,Franz2018}. Considering particular examples, over Lake Victoria convective activity is suppressed during the day and peaks at night, leading to intense, hazardous thunderstorms \citep{Thiery2015,Thiery_2017}; Lake Ladoga can generate low level clouds which can cause variability in the 2m temperature of up to 10 K \citep{Eerola2014}; the Laurentian Great Lakes can cause intense winter snow storms \citep{Vavrus2013} \citep{Notaro2013}. Moreover, as a result of the increased temperatures due to climate change, lakes become more numerous due to the melting of glaciers and permafrost. Additionally, the higher temperatures mean that previously permanent lake bodies become seasonal or intermittent. There is then evidently a huge potential return in the ability to accurately model the location, morphology and properties of lakes in weather and climate models. \newline 


\noindent The Integrated Forecasting System (IFS) at the European Centre for Medium Range Weather Forecasts (ECMWF) is used operationally for numerical weather prediction and climate modelling. Earth-system modelling in the IFS can be broadly categorised into large-scale and small-scale processes. Large-scale processes can be described by numerically solving the relevant set of differential equations, to determine e.g. the general circulation of atmosphere. Conversely, small-scale processes such as clouds or land-surface processes are represented via parametrisation. Accurate parametrisations are essential for the overall accuracy of the model. For example, the parametrisation of the land surface determines the sensible and latent heat fluxes, providing the lower boundary conditions for the equations of enthalpy and moisture in the atmosphere \citep{p16960}. \newline 

\noindent Lakes are incorporated in Earth-system models via parametrisation. At ECMWF the  representation of lakes via parametrisation was first handled by introducing the Fresh water Lake model FLake \citep{Mironov2008} into the IFS. FLake treats all resolved inland waterbodies (i.e. lakes, reservoirs, rivers which are dominating in a grid-cell) and unresolved or sub-grid water (i.e. small inland waterbodies and sea/ocean coastal waters which are present but not dominating in a grid-cell). Note that lake parameters are also an important part of the FLake model so when we refer in this work to ``lake parametrisation" we mean both the model and the parameters. The broad impact of the FLake model and the important role that waterbodies play in human life can be illustrated by analysing ECMWF maps of the fractional land sea mask and the inland waterbody cover alongside maps of the population density (i.e. inhabitants per km$^2$) based on the population count for 2015 from the Global Human Settlement Layers (GHSL), Population Grid 1975-2030 \citep{GHS,JRC100523} at 9 km horizontal resolution. Globally FLake is active over 11.1\% of the grid-cells, with only 1.2\% of them being resolved inland waters (i.e. water covers $\geq$50\% of the grid-cell); considering only non-ocean (i.e. land) grid-cells, then FLake is active over 32.4\% of the grid-cells with only 3.5\% of them being resolved waters. According to the population data, only 4\% of land is densely populated (i.e. at least 300 inhabitants per km$^2$); 64.5\% of these areas being situated within a 9 km radius of a permanent waterbody (i.e. inland water or sea/ocean coast) with half of it (i.e. 31.2\% of densely populated areas) being in the vicinity of at least 1 km$^2$ waterbody - emphasising how essential waterbodies are in human life. In some regions this role may be even more crucial than in the others. For example, only 2\% of the North American region (similar for South American and North Asian regions) is densely populated with 45.7\% (33.9\% and 37.9\% respectively) of the areas being in vicinity of at least 1 km$^2$ waterbody; for Europe even though it has more densely populated areas (16\% of land is densely populated) still 37.4\% of the population are in the vicinity of at least a 1 km$^2$ waterbody; for a rather dry continent like Africa only 5\% of land is densely populated with 22.2\% of these areas being close to at least a 1 km$^2$ waterbody; most striking in this sense is Australia where only 0.5 \% of the land is populated, with two thirds of the population living within 9 km radius of a permanent waterbody of at least 1 km$^2$, with the majority of people living on the ocean coast. \newline 

\noindent It is a continuous enterprise to update the lake parametrization schemes and their input data fields to better represent small-scale surface processes. It is however challenging to accurately represent lakes in these parametrisations; the majority of lakes which are resolved at a 9km grid spacing have not had their morphology accurately measured, let alone monitored, whilst 28.9$\%$ of land and coastal cells are treated for sub-grid (i.e. covering half or less of a grid cell) water. When introducing an updated lake representation it is difficult apriori to determine the additional value gained through doing so. There are two key factors here:
\begin{itemize}
	\item Are the updated fields closer to reality?
	\item Do the updated fields increase the accuracy of the model predictions?
\end{itemize}
The first point is straightforward; we want our parametrisation fields to better represent reality. If the lake depth of some lake is updated from 10m to 100m we want to be sure that 100m is closer to the true depth of the lake. For the second point, even if the updated fields are accurate, are they informative in the sense that they enable us to make more accurate predictions? For instance, the main target of lake parametrization is to reproduce lake surface water temperatures (and therefore evaporation rates). If a lake parametrisation scheme is updated to better represent different types of inland waterbodies, the time variability of inland waterbodies and/or the lake morphology fields use more in situ measurements, does this additional information allow for more accurate predictions of the lake surface water temperatures? Is it therefore worthwhile to update the parametrisation in this way? Since the resulting updated fields are ultimately used operationally, it is essential to ensure the accuracy of the fields and prevent any potential degradation or instability of the model. This problem of quickly and automatically verifying the accuracy and information gain of updated lake parametrisations is the aim of this work. \newline

\noindent Numerical weather prediction and climate modelling are fields that are inherently linked with large datasets and complex, non-linear interactions. It is therefore an area that is particularly well placed to benefit from the deployment of machine learning algorithms. At ECMWF, advanced machine learning techniques have been used for parametrisation emulation via neural networks \citep{Chantry2021}, 4D-Var data assimilation \citep{Hatfield2021} and the post-processing of ensemble predictions \citep{Hewson2021}. Indeed, the early successes of these machine learning methods have led to the development of a 10-year roadmap for machine learning at ECMWF \citep{p19877}, with machine learning methods looking to be integrated into the operational workflow and machine learning demands considered in the procurement of HPC facilities; the ongoing development of novel computer architectures (e.g. GPU, IPU, FGPA) motivates utilizing algorithms and techniques which can efficiently take advantage of these new chips and gain significant performance returns. In this work we will demonstrate a new technique for the Verification of Earth-System ParametERisation (VESPER) based on a deep learning neural network regression model. This tool enables the accuracy of an updated water body parametrization to be rapidly and automatically assessed, and the added value that such an updated parametrization brings to be quantitatively evaluated. \newline 


\noindent This paper is organized as follows. In Section \ref{sec:2} we describe the construction of the VESPER tool - the raw input data, the processing steps and the construction of a neural network regressor. In Section \ref{sec:3} we then deploy VESPER to investigate and evaluate updated lake parametrisation fields. Discussion and concluding remarks are made in Sections \ref{sec:discussion} and \ref{sec:conclusion} respectively. 


\section{Constructing VESPER}\label{sec:2}
In order to rapidly assess accuracy of new surface physiography fields and if their use in the model increase predictability a neural network regression model (further in the text referred as VESPER) that can learn the mapping between a set of features x and targets y is constructed. In this case the features are the atmospheric and surface model fields (such as 2 metre temperature from ERA5 reanalysis) and the surface physiographic fields (such as orography and vegetation cover used to produce ERA5 reanalysis), see Table 1 for the full list of variables used. The target is the satellite land surface temperature (skin temperature from MODIS Aqua Day MYD11A1 v006 collection).VESPER can then make predictions about the skin temperature given a set of input variables (i.e. atmospheric and surface model fields, and surface physiographic fields). In turn, these predictions can then be compared against observations (i.e. satellite skin temperature) and VESPER's accuracy evaluated. By varying the number/type and values of the input features x to VESPER and observing how the accuracy of its predictions change, some conclusions on if and how features can increase predictability of an actual atmospheric model. Moreover, by isolating geographic regions where the predictions get worse with new/updated surface physiographic fields, areas where these fields might be erroneous or not informative enough can be identified. Due to the inherent stochasticity of training a neural network regression model it is also possible for different models to settle in different local minimums i.e. the network variance. To understand the significance of this, every VESPER configuration was trained four times, each time with a different random seed. \newline 
	

\noindent In this section we will now describe the data used for the features $x$ and targets $y$ in the neural network regression model, how various data types are joined together, and the details of VESPER’s construction.



\subsection{Features and targets}
VESPER's input feature selection (see Table \ref{table:definitions}) followed (i) permutation importance results for atmospheric and surface model fields - only fields with the highest importance were chosen; and (ii) expert choice for surface physiographic fields - as first attempt it was decided to test current methodology for lake related information, therefore fields that could be most affected by the presence of absence of water were selected, e.g. if lake had to be removed then some other surface had to appear (like bare ground, high or low vegetation, glacier or even ocean) and surface elevation had to change. Changes to the orographic fields will have important influences on temperature through e.g. wind, solar heating etc. Lake depth changes are similarly important, influencing how a lake freezes, thaws, mixes and its overall dynamical range. VESPER's target selection followed globally available criteria and the satellite land surface temperature is quite well observed globally and with high temporal pattern (daily or even several times a day depending on the location)

\begin{table*}
	\begin{tabularx}{\textwidth}{lX}
		\hline
		Atmospheric and surface model fields (11 fields)
		     & \textbf{Pressure}: surface pressure (\textit{sp, Pa}), mean sea level pressure (\textit{msl, Pa}), \newline 
		\textbf{Wind}: 10 metre U wind component (\textit{10u, m/s}), 10 metre V wind component (\textit{10v, m/s}), \newline 
		\textbf{Temperature}: 2 metre temperature (\textit{2t, K}), 2 metre dewpoint temperature (\textit{2d, K}), skin temperature (\textit{skt, K}), ice temperature layer 1 (the sea-ice temperature in layer 0-7 cm; \textit{istl1, K}), ice temperature layer 2 (the sea-ice temperature in layer 7-28 cm; \textit{istl2, K}), \newline 
		\textbf{Surface albedo:} forecast albedo (\textit{fal, 0-1}), \newline 
	\textbf{Snow:} snow depth (\textit{sd, m} of water equivalent)
		
		\\
		Main surface physiographic fields
		(19 fields)          & \textbf{Orographic fields:} standard deviation of filtered subgrid orography (\textit{sdfor, m}), standard deviation of orography (\textit{sdor, m}), anisotropy of sub-gridscale orography (\textit{isir}, -), angle of sub-gridscale orography (\textit{anor, radians}), slope of sub-gridscale orography (\textit{slor, -}), geopotential (the gravitational potential energy of a unit mass, at a particular location, relative to mean sea level; at the surface of the Earth, this parameter shows the variation in geopotential (height) of the surface, and is referred to as the orography; \textit{z}, $m^{2} s^{-2}$), \newline  
		\textbf{Land fields:} land-sea mask (the proportion of land, as opposed to ocean or inland waters (i.e. lakes, reservoirs, rivers, coastal waters), in a grid-cell; \textit{lsm, 0-1}), glacier mask (the proportion of a grid-cell covered by glacier; \textit{glm, 0-1}), \newline 
		\textbf{Water fields:} lake cover (the proportion of a grid-cell covered by inland water bodies; \textit{cl, 0-1}), lake total depth (the mean depth of inland water bodies; \textit{dl, m}), \newline 
		\textbf{Vegetation fields:} low vegetation cover (\textit{cvl, 0-1}), high vegetation cover (\textit{cvh, 0-1}), type of low vegetation (\textit{tvl}, -), type of high vegetation (\textit{tvh}, -), \newline 
		\textbf{Soil fields:} soil type (\textit{slt}, -), \newline 
		\textbf{Albedo fields:} UV visible albedo for direct radiation (\textit{aluvp}, 0-1), UV visible albedo for diffuse radiation (\textit{aluvd}, 0-1), near IR albedo for direct radiation (\textit{alnip}, 0-1), near IR albedo for diffuse radiation (\textit{alnid}, 0-1)
		
		\\
		Additional surface physiographic fields:               & Difference for all main surface physiographic fields between V15 and V20 field sets, \newline 
		Difference between V20 static lake cover and monthly varying lake cover (12 maps in total),\newline 
		Saline lake cover (the proportion of a grid-cell covered by saline inland water bodies; units: 0-1)
		 \\
		\hline
	\end{tabularx}
\caption{Input features used for training the NN model VESPER; atmospheric model fields (time varying) were kept the same in all simulations,  surface  physiographic  fields  (static)  were  updated  when  going  from  the  original  data  based  on GlobeCover2009/GLDBv1 (V15 field set) to GSWE/GLDBv3 (V20 field set); in brackets are variables description (where needed), short name (according to the GRIB parameter database) and units.
}
\label{table:definitions}
\end{table*}

\subsection{Data sources }

There are three main sources of data. The first is selection of surface physiographic fields from ERA5 \citep{Hersbach} and their updated versions \citep{Choulga2019,Boussetta2021,Mu2021} used as VESPER’s features.
The second is a selection of atmospheric and surface model fields from ERA5, also used as VESPER’s features. The third is day-time land surface temperature measurements from the Moderate Resolution Imaging Spectroradiometer (MODIS) onboard the Aqua satellite \citep{MODIS}, used as VESPER’s target variable.


\subsubsection{Surface physiographic fields}\label{sec:surface_physio}
\noindent Surface physiographic fields have gridded information of the Earth’s surface properties (e.g. land-use, vegetation type and distribution) and represent surface heterogeneity in the ECLand of ECMWF’s Integrated Forecasting System (IFS). They are used to compute surface turbulent fluxes (of heat, moisture and momentum) and skin temperature over different surfaces (vegetation, bare soil, snow, interception and water) and then to calculate an area-weighted average for the grid-box to couple with the atmosphere. To trigger all different parametrization schemes the ECMWF model uses a sets of physiographic fields, that do not depend on initial condition or forecast step. Most fields are constant; surface albedo is specified for 12 months to describe the seasonal cycle. Dependent on the origin, initial data comes at different resolutions and different projections, and is then first converted to a regular latitude-longitude grid (EPSG:4326) at ~1km at Equator resolution and secondly to a required grid and resolution. Surface physiographic fields used in this work consist of orographic, land, water, vegetation, soil, albedo fields and their difference between initial V15 and updated V20 field sets (and between expanded V15X and V20X field sets). See Tables \ref{table:definitions} and \ref{tab:datasources} for the full list of surface physiographic fields and their input sources; for more details see IFS documentation \citep{IFSdocs}. As this work is focused on assessing quality of inland water information, main surface physiographic fields are lake cover (derived from land-sea mask) and lake mean depth (see Table \ref{tab:datasources}).  \newline 
\begin{table*}
	\begin{tabularx}{\textwidth}{lXX}
		\toprule 
		Field Category & V15 & V20 \\
		\hline
		Orographic & SRTM30 Shuttle Radar Topography Mission over 60°N-60°S; GLOBE: Global Land One-km Base Elevation Project data over 90-60°N; RAMP2: high-resolution Radarsat Antarctic Mapping Project Digital Elevation Model version 2 data \citep{Liu2015} over 60-90°S; BPRC: Byrd Polar Research Center over Greenland; IS 50V: Digital Map Database of Iceland over Iceland & As V15, with corrections to to erroneous shift
		\\
		\hline 
		Land   & \textbf{Source lsm:} GlobCover2009 \citep{GLOBCOVER,arino2012glcm} over 85°N-60°S; RAMP2: high-resolution Radarsat Antarctic Mapping Project Digital Elevation Model version 2 data \citep{Liu2015} over 60-90°S; no land assumed over 90-85°N \newline  
		\textbf{Source glm:} GLCC: Global Land Cover Characteristics version 2.0 over 90°N-90°S except Iceland; Icelandic Meteorological Office (IMO) glacier mask 2013 over Iceland
		 & \textbf{Source lsm:} GSWE: Global Surface Water Explorer \citep{GSWE}; glm \newline 
		 \textbf{Source glm:} Norwegian Institute glacier data over Svalbard; Icelandic Meteorological Office (IMO) glacier mask 2017 over Iceland; GIMP: Greenland Ice Mapping Project data \citep{Howat2014} over Greenland; CryoSat-2 satellite glacier data \citep{Slater2018} over Antarctica (+ manual gap filling);  GLIMS: Global Land Ice Measurements from Space data \citep{glims} over rest of the globe \\
		\hline
				Water   & 
				\textbf{Source cl:} \textit{lsm} (ocean is separated at actual resolution by seeding and removing all connected grid-cells, includes the Caspian Sea, the Azov Sea, The American Great Lakes) \newline 
				\textbf{Source dl:} The Caspian Sea bathymetry; Global Relief Model ETOPO1 \citep{amante2009egrm} over the Great Lakes, the Azov Sea; GLDB: Global Lake DataBase version 1 \citep{Kourzeneva2012} over rest of the globe; 25 meters assumed over missing data grid-cells
		& \textbf{Source cl:} \textit{lsm} (ocean is separated at ~1km resolution by upgraded flooding algorithm following \cite{Choulga2019} \newline 
		\textbf{Source dl:} GEBCO: General Bathymetric Charts of the Ocean \citep{Weatherall2015} over the Caspian Sea and the Azov Sea; Global Relief Model ETOPO1 \citep{amante2009egrm} over the Great Lakes; GLDB: Global Lake DataBase version 3 \citep{Choulga2014} over rest of the globe; indirect estimates based on geological origin of lakes \citep{Choulga2014} over missing data grid-cells \\
		\hline 
		Vegetation & GLCC: Global Land Cover Characteristics version 1.2. Note that vegetation type represent only dominant type over grid-cell & As V15 \\ 
		\hline
		 Soil & DSMW: FAO/UNESCO Digital Soil Map of the world \citep{FAO}. Note that soil type represent only dominant type over grid-cell & As V15 \\ 
		 \hline 
		 Albedo & MODIS 5-year climatology \citep{SCHAAF2002135}; RossThickLiSparseReciprocal BRDF model. note that Albedo values represent snow free surface albedo & As V15 \\ 
		\bottomrule
	\end{tabularx}
	\caption{List of input datasets for the surface physiographic fields for V15 and V20 field sets. V15X and V20X are identical to V15 and V20 respectively, but with the addition of saline lake cover, and monthly varying lake cover fields. \hl{TK: is glacier mask binary in V15 and 0-1 in V20?}}
	\label{tab:datasources}
\end{table*}
\noindent To generate V15 (and V15X) fractional lake cover the GlobCover2009 global map  \citep{GLOBCOVER,arino2012glcm} is used. This map has a resolution of 300m, corresponds for the year 2009 and covers latitudes 85°N-60°S; corrections outside these latitudes for the polar regions are included separately. In the Arctic no land is assumed, in the Antarctic data from the high-resolution Radarsat Antarctic Mapping Project digital elevation model version 2 (RAMP2; Liu et al., 2015) is used. To generate V20 (and V20X) fractional lake cover more resent higher resolution datasets and updated methods have been used \citep{Choulga2019}. Main data source is the Joint Research Centre (JRC) the Global Surface Water Explorer (GSWE) dataset \citep{GSWE}. GSWE is a 30m resolution dataset from Landsat 5,7 and 8, providing information on the spatial and temporal variability of surface water on the Earth since March 1984; here only permanent water type was used for lake cover generation as it was more accurate inland water distribution on the annual basis \citep{Choulga2019}. Differences between V20 and V15 lake cover fields (see Figure 1) are consistent with the latest global and regional information: (i) increase of lake fraction in V20 compared to V15 over northern latitudes is due to permafrost melt leading to a new thermokarst lake emergence, and due to higher resolution input source and its better satellite image recognition methodologies; (ii) reduction of lake fraction in V20 compared to V15 can be explained with several reasons, like anthropogenic land use change (e.g. Aral Sea, which lies across the border between Uzbekistan and Kazakhstan, has been shrinking at an accelerated rate since the 1960s and started to stabilise in 2014 with an area of 7660km2, 9 times smaller than its size in 1960. GlobCover2009 describes the Aral Sea in 1998, when it was still “only” two times smaller than its 1960 extent, whereas GSWE provides a more up to date map.), use of only permanent water (e.g. Australia, where GlobCover2009 over-represents inland water, as most of these lakes are highly ephemeral, e.g. the endorheic Kati Thanda–Lake Eyre fills only a few times per century. The GSWE updates to this region therefore include only generally permanent water, removing all seasonal and rare ephemeral water.), and change in the ocean and inland water separation algorithm (e.g. north-east of Russia). \newline 

\noindent To generate V15 (and V15X) lake mean depth (see Figure \ref{example_figure_a}) the Global Lake DataBase version 1 \citep[GLDBv1;][]{Kourzeneva2012} is used. GLDBv1 has a resolution of ~1km and is based on ~13000 lakes with in situ lake depth information; outside this dataset all missing data grid-cells (i.e. over ocean and land) have 25 meter value; field aggregation to a coarser resolution is done by averaging. Overestimation of lake depth in summer season can result in strong cold biases and in winter season – lack of ice formation. To generate V20 (and V20X) lake mean depth (see Figure \ref{example_figure_b}) an updated version GLDBv3 \citep{Choulga2014} is used. GLDBv3 has the same resolution of ~1km, but is based on an increased number of lakes with in situ lake depth information by ∼1500 (in addition has bathymetry information over all Finnish navigable lakes), it introduces distinction between freshwater and saline lakes (this information is currently not used by FLake), and suggests the method to assess the depth for lakes without in situ observations using geological and climate type information; field aggregation to a coarser resolution is done by computing the most occurring value. Verification of GLDBv1 and GLDBv3 lake depths against 353 Finnish lake measurements shows that GLDBv3 exhibits a 52 \% bias reduction in mean lake depth values compared to GLDBv1 \citep{Choulga2019}. For a further details on lake distribution and depth, the representation of lakes by ECMWF in general see \cite{Choulga2019}  and \cite{Boussetta2021}. \newline 

To expand V15 and V20 lake description (to V15X and V20X respectively, see Table \ref{tab:datasources}) their salinity and time variability information was generated. Even though static permanent water fits better to describe inland water distribution on average all year round, some areas (in Tropics especially) would really benefit from having monthly varying information as they have a very strong seasonal cycle, when size, shape and depth of a lake changes over the course of the year, leading to a significant changes in modelling the lake temperature response. Similarly, saline lakes behave very differently to fresh water lakes since increased salt concentrations affect the density, specific heat capacity, thermal conductivity, and turbidity, as well as evaporation rates, ice formation and ultimately the surface temperature. These two properties of time variability and salinity are often related; it is common for saline lakes to fill and dry out over the course of the season, which naturally also affects the relative saline concentration of the lake itself. To create a monthly varying lake cover first 12 monthly fractional land-sea masks based on JRC Monthly Water History v1.3 maps for 2010-2020 were created. Since the annual lake maps were created taking into account a lot of additional sources the extra condition on the monthly maps that the monthly water is equal or greater than permanent water distribution from fractional land-sea mask is enforced. To create an inland salt lake cover GLDBv3 salt lake list was used. First, in order to identify separate lakes on ~1km resolution lake cover (here max lake distribution based on monthly varying lake cover is used to ease further application), small sub-grid lakes and large lake coasts are masked, i.e. grid-cells that have water fraction less than 0.25. Next, number of connected grid-cells in each lake (i.e. connected with sides only) is computed. Then only lakes that have 100 and more connected grid-cells are vectorised, as at ERA5 resolution of ∼31km the grid-cells are quite large and can include a mixture of freshwater and saline lakes. Finally, saline lake vectors are selected by filtering vectors which have no saline lake point from GLDBv3 located – in total 147 large salt lake vectors, which were further used to filter non-saline lakes at ~1km resolution lake cover, finally aggregated to ~31km resolution. In the future it is planned to revisit this field and extend the list to include additional data. Note that all non-lake related climate fields such as vegetation cover or orography were updated in V20 field set compared to V15 only in relation to the changing lake fields (i.e. if fraction of lake in the grid cell increased then other fractions like vegetation or bare ground should have increased accordingly). 

\begin{figure}
	\subfloat[\label{fig:cl_map}]{\includegraphics[width=0.48\textwidth]{cl_map}} \\
	\subfloat[\label{fig:cl_delta_map}]{\includegraphics[width=0.48\textwidth]{cl_delta_map}}
	\caption{At ~31km resolution (a) V20 fractional lake cover and (b) difference between V20 and V15 lake covers. Over northern latitudes inland water increase in V20 compared to V15 is due to higher resolution input source and its better satellite image recognition methodologies; inland water reduction in V20 compared to V15 is due to anthropogenic land use changes (e.g. Aral Sea) or due to use of only permanent water (e.g. Australia) which was proven to better represent inland water distribution on annual basis.} 
	\label{fig:example_figure_a}
\end{figure}








\begin{figure}
	\subfloat[\label{fig:dl_map}]{\includegraphics[width=0.48\textwidth]{dl_map}} \\
	\subfloat[\label{fig:dl_delta_map}]{\includegraphics[width=0.48\textwidth]{dl_map_diff}}
	\caption{At ~18km resolution mean lake depth in meters (a) V15 and (b) V20. In general lake mean depth has decreased in V20 compared to V15 due to use of mean depth indirect estimates based on geological and climate information instead of default 25 meter value over lakes without in situ observations.} 
	\label{fig:example_figure_b}
	\end{figure}









\subsubsection{ERA5}
\noindent Climate reanalyses combine observations and modelling to provide calculated values of a range of climactic variables over time. ERA5 is the fifth generation reanalysis from ECMWF. It is produced via 4D-Var data assimilation of the atmospheric Integrated Forecast system cycle 41R2, coupled to a land-surface model \citep[ECLand,][]{Boussetta2021}, which includes lake parametrization by the Fresh water Lake model Flake \cite{Mironov2008} and an ocean wave model (WAM). The resulting data product provides hourly values of climatic variables across the atmosphere, land and ocean at a resolution of approximately 31km with 137 vertical sigma levels, up to a height of 80km. Additionally, ERA5 provides associated uncertainties of the variables at a reduced 63km resolution via a 10-member Ensemble of Data Assimilations (EDA). In this work ERA5 hourly surface fields at ∼ 31km resolution on a reduced Gaussian grid are used. Gaussian grid’s spacing between latitude lines is not regular, but lines are symmetrical along the Equator; the number of points along each latitude line defines longitude lines, which start at longitude 0 and are equally spaced along the latitude line. In a reduced gaussian grid, the number of points on each latitude line is chosen so that the local east-west grid length remains approximately constant for all latitudes (here Gaussian grid is N320, where N is the number of latitude lines between a Pole and the Equator). Main field used from ERA5 is skin temperature (i.e. temperature of the uppermost surface layer, which has no heat capacity and instantaneously responds to changes in surface fluxes) that forms the interface between the soil and the atmosphere. Skin temperature is a theoretical temperature computed by linearizing the surface energy balance equation for each surface type separately, and its feedback on net radiation and ground heat flux is included; for more information see IFS Documentation (2021). ERA5 skin temperature verification against MODIS LST ensemble (i.e. all four MODIS observations were used, namely Aqua Day and Night, Terra Day and Night) over 2003-2018 period showed good correlation between two datasets; errors between ERA5 and MODIS LST ensemble are quite small, i.e. spatially and temporally averaged bias is 1.64K, RMSE is 3.96K, Pearson correlation coefficient is 0.94, and anomaly correlation coefficient is 0.75 \citep{essd-13-4349-2021}. ERA5 skin temperature verification against the Satellite Application Facility on Land Surface Analysis (LSA-SAF) product over Iberian Peninsula showed a general underestimation of daytime LST and slightly overestimation at night-time, relating the large daytime cold bias with vegetation cover differences between ERA5 surface physiography fields and the European Space Agency’s Climate Change Initiative (ESA-CCI) Land Cover dataset; use of ESA-CCI low and high vegetation cover instead of ERA5 ones led to a complete reduction of the large maximum temperature bias during summer \citep{Johannsen2019}. ERA5 data is obtained via the Copernicus Climate Data Store \citep[CDS,][]{CDS}.





\subsubsection{Aqua-MODIS}


\noindent Aqua  \citep{aquaref} is a NASA satellite mission which makes up part of the Earth Observing System (EOS). Operating at an altitude of 700km, with orbital period of 99 minutes, its orbital trajectory passes south to north with an equatorial-crossing times in general of 1.30pm. This post-meridian crossing time has led to it sometimes being denoted as EOS PM. Launched in 2002 with an initial expected mission duration of 6 years, Aqua has far exceeded its initial brief and continues to transmit information from 4 of the 6 observation instruments on board. Here we use information only from MODIS instrument. MODIS can take surface temperature measurements at a spatial resolution of 1km (the exact grid size is 0.928km by 0.928km), operating in the wavelength ranges of between ∼3.7-4.5µm and ∼10.9-12.3µm. In addition to surface temperature measurements that were used in this work, MODIS can take observations of cloud properties, water vapour, ozone etc. Here MYD11A1 v006 \citep{MODISusersguide} collection that provides daily Land Surface Temperature (LST) measurements at a spatial resolution of 1km on a sinusoidal projection grid SR-ORG:6974 (takes a spherical projection but a WGS84 datum ellipsoid) is exercised. Daily global LST data is generated by first applying a split-window LST algorithm \citep{508406} on all nominal (i.e. 1km at nadir) resolution swath (scene) with a nominal coverage of ~5 minutes of MODIS scans along the track acquired in daytime, and secondly by mapping results onto integerized sinusoidal projection; for more details see Figure \ref{example_figure_c} and \citep{MODISusersguide}. Validation of this product was carried out using temperature-based method over different land cover types (e.g. grasslands, croplands, shrublands, woody areas, etc.) in several regions around the globe (i.e. United States, Portugal, Namibia, and China) at different atmospheric and/or surface conditions; the best accuracy is achieved over United States sites with RMSE lower than 1.3K \citep{DUAN201916}. At large view angles and in semi-arid regions product may have slightly higher errors due to rather uncertain classification-based surface emissivities and heavy dust aerosols effects. In addition, MODIS Cloud Mask struggles to eliminate all cloud and/or heavy aerosols contaminated grid-cells from the clear-sky ones (LST errors in such grid-cells can be 4-11K and larger). Validation of this product over five bare ground sites in north Africa (in total 12 radiosonde-based datasets validated) showed that mean LST error was within $\pm$0.6K (with exception for one dataset, where mean LST error was 0.8K) and standard deviation of LST errors were less than 0.5K \cite{DUAN201916}. In this work to reduce the amount of daily data over multiple years to store and manipulate, prior use LST data is (i) filtered to contain only cloud free data, and (ii) averaged to a ~4km at the Equator resolution on a regular latitude-longitude grid, EPSG 4326 (note that only grid cells which have 8 or more valid observations at 1km resolution are averaged over, otherwise they are classified as missing data).



%\begin{figure}
%	\subfloat[\label{fiig:Modistime1}]{\includegraphics[width=0.48\textwidth]{example-image-c}} \\
%	\caption{A brief step-by-step explanation of the LST algorithm for MYD11A1 v006 collection.} 
%	\label{fig:example_figure_c}
%\end{figure}

\subsection{Joining the data}\label{sec:join}
To join selected ERA5 global fields on a reduced Gaussian grid at ~31km resolution (information in UTC, 24 hourly maps per day) with Aqua-MODIS global LST data on a regular latitude-longitude grid at ~4km resolution (information in local solar time, 1 map per day), both datasets need to be at the same time space. First it is necessary to determine the absolute time (i.e. UTC) at which the MODIS observations were taken. Since in general all Aqua observations are taken at 1.30pm local solar time, it can be related to a UTC via observation longitude, following Eq. (1):
\begin{equation}
	\text{UTC} = \text{Local solar time} - \frac{\text{longitude}}{15} \ , 
\end{equation}
where longitude is in degrees, and UTC is rounded to the nearest hour. This conversion is inexact since there is an additional correction as a function of the latitude, yet recommended by the official MODIS Products User’s Guide \cite{MODISusersguide}; given the short orbital period of Aqua these additional higher order corrections are expected to be typically small and for our purposes can be neglected. Also, assumption that all Aqua observations are taken at 1.30pm local solar time was checked (see Figure \ref{fig:MODIS_time_error}). The annually averaged mean time difference at ~31km resolution (i.e. daily differences between local solar time of observations and 1.30pm at 1km resolution were first aggregated to 31km resolution using averaging, and then aggregated in time over a year) is 0.16 hours or 10 min, with mean absolute error (MAE) being 0.46 hours or 28 min and root mean square error (RMSE) being 0.61 hours or 37 min (current values correspond 70N-70S region year 2019, but confirmed to be approximately identical for each year of 2016-2019 period). Since temporal resolution of ERA5 data is hour, proposed assumption has sufficient accuracy. Over the poles (i.e. 90-70°N and 70-90°S) satellite sweeps overlap significantly and in general conversion becomes less accurate (daily time differences can reach more than $\pm$ 3.5 hours), so these areas were not included in the analysis. \newline 

\noindent Once Aqua-MODIS time of observation is converted to UTC, Aqua-MODIS data at ~4km resolution is matched in time and space to ERA5 information in a following way: (i) take a single Aqua-MODIS LST observation at a particular point on the MODIS grid, (ii) select ERA5 global hourly map matching Aqua-MODIS LST observation time in UTC, (iii) find the nearest point on the ERA5 grid to that MODIS grid point, (iv) repeat previous steps for every Aqua-MODIS observation, (v) group matched data pairs by the ERA5 grid points, averaging over all the Aqua-MODIS observations that are associated with each ERA5 point. At the end selected ERA5 fields are mapped to a single Aqua-MODIS time of observation and Aqua-MODIS LST data is mapped (i.e. multiple Aqua-MODIS observations could be averaged over, see Figure \ref{modis_plot_1}) to a reduced Gaussian grid at ~31km resolution; averaged Aqua-MODIS observations are considered as ground truth (i.e. targets $y$) that VESPER is trying to predict. To better understand VESPER’s grid-cell results at ~31km resolution additional information was computed from Aqua-MODIS, namely (i) total number of valid observations per month and year (see Figure \ref{modis_plot_1}), and (ii) average LST error based on Aqua-MODIA quality assessment (i.e. quality flag, see Figure \ref{modis_plot_1}). Based on this additional information it can be concluded that areas with sparse number of observations in general have more uncertain LST values; exceptions are Alaska in United States and Anadyrsky District in Russia (area 30° east and west from 180°E around 70-60°N), deserts of Australia and Kalahari desert in Namibia, Botswana and South Africa, where majority of vast number of observations have only good or average quality.

\begin{figure}
	\includegraphics[width=0.48\textwidth]{MODIS_local_solar_time_diff}
	\caption{The annually averaged mean time difference of Aqua-MODIS and assumed local solar time of 1.30pm for the year 2019 at ~31km resolution. Time differences are generally sub-hour and grow at greater latitudes, so data over 90-70°N and 70-90°S is excluded, and observation time globally is assumed constant at 1.30pm local solar time.} 
	\label{fig:MODIS_time_error}
\end{figure}


\begin{figure}
	\subfloat[\label{fig:modis_plot_1}]{\includegraphics[width=0.48\textwidth]{num_obs_map}} \\
	\subfloat[\label{fig:modis_plot_2}]{\includegraphics[width=0.48\textwidth]{MODIS_obs_error}}
	\caption{For 2019 at ~31km resolution: (a) Mean daily number of Aqua-MODIS observations mapped to each ERA5 data point. The swath of the Aqua satellite is clearly visible, with more observations over 70-60°N and 60-70°S areas as Aqua follows a polar orbit, south to north, and with less observations over Equator, complex orography areas (such as the Himalayas, the Andes and the Rocky Mountains), and the Siberian Tundra (due to increased cloud cover). (b) Average error in the Aqua-MODIS LST measurement. The raw Aqua-MODIS data at ~1km resolution provides categorical LST errors with bins ≤ 1K, 1-2K, 2-3K and > 3K. When averaging to the coarser resolution a weighted average over the 1km grid-cells is computed, where the median bin value is used, and 5K for the > 3K bin. This information helps to understand that abundant number of observation does not automatically mean high quality of LST (e.g. Australia).} 
	\label{fig:MODIS_time_error_N}
\end{figure}
\noindent The second step in joining ERA5 and Aqua-MODIS LST data uses a GPU-accelerated k-nearest neighbours algorithm \cite{Rapids}, where “nearness” on the sphere between two points is measured via the Haversine metric i.e. the geodesic distance H, following Eq. (2):
\begin{equation}
	H = 2 \arcsin (d)
\end{equation}
where
\begin{eqnarray}
	d = \sqrt{\sin^2\left(\frac{\delta\theta}{2}\right) + \cos \theta_1 \cos \theta_2 \sin^2\left(\frac{\delta \phi}{2}\right) }
\end{eqnarray} 
for two points with coordinate latitudes $\theta_{1,2}$, longitudes $\phi_{1,2}$ and $\delta \theta = \theta_2 - \theta_1$ and  $\delta \phi = \phi_2 - \phi_1$ . 








%\begin{figure}
%	\includegraphics[width=0.48\textwidth]{MODIS_obs_error}
%	\caption{Average error in the MODIS LST measurement at a 31km resolution. The raw MODIS data at a 1km resolution provides categorical LST errors with bins $\leq 1$K, $1 - 2$K $2-3$K and $>3$K. When averaging to 31km resolution we compute a weighted average over the 1km grid cells, where we take the median bin value, and $5$K for the $>3$K bin.} 
%	\label{fig:MODIS_obs_error}
%\end{figure}



%\begin{figure}
%	\includegraphics[width=0.48\textwidth]{num_obs_map.png}
%	\caption{Mean daily number of MODIS observations mapped to each ERA5 data point for 2019. The swath of the Aqua satellite is clearly visible, with more observations at more extreme latitudes as Aqua follows a polar orbit, south to north. In addition to the expected increased sparsity of observations at the equator, there are also notably fewer observations in regions of greater orography such as the Himalayas, the Andes and the  Rocky Mountains as well as the Siberian Tundra, due to increased cloud cover.} 
%	\label{fig:MODIS_obs}
%\end{figure}

\subsection{Constructing a regression model}
VESPER is trained to learn the mapping between features $x$ and targets $y$ (i.e. mapping ERA5 to MODIS), a regression problem. For this purpose a fully-connected neural network architecture (also known as a multi-layer perceptron), implemented in Tensorflow \citep{2016arXiv160304467A} was used. Whilst more advanced architectures are available, for the purposes of this work the model is sufficient enough, which exhibits generally fast and dependable convergence. The networks built have differing number of nodes in the input layer, depending on the number of predictors (see table below). For all networks constructed we use 4 hidden layers and a layer width is half that of the input layer width. ADAM \citep{2014adam} is used as an optimisation scheme, learning rate is set to $3 \times 10^{-4}$, and default values for the exponential decay rate for the 1st and 2nd moment estimates are set to of 0.90 and 0.999 respectively. The network is not trained for a fixed number of epochs, but instead trained until the validation error reaches a minimum. Techniques for maximising the performance of a network via hyperparameter optimisation are now well established \citep{HPO1,HPO2}. However, for the purposes of this work no attempt to tune hyperparameters was made, just some reasonable default values were applied which were assumed to be “good enough”. Some exploration of different hyperparameter configuration was undertaken, but for this data the prediction accuracy is mostly independent of the hyperparameter configuration, subject to standard and reasonable hyperparameter choices. Whilst a more advanced automatic hyperparameter optimization method may have enabled slightly higher performance of VESPER, ultimate purpose is not to generate the most absolutely accurate prediction possible, but instead to have two predictive models which can be compared. In the result section below it will be shown that the variation in performance due to input feature modifications is far greater than the variation due to the hyperparameter choices. \newline 

 \noindent VESPER was trained on selected atmospheric and surface model fields from ERA5 (see Table \ref{table:definitions}), certain static version of the surface physiographic fields (see Table \ref{tab:datasources}), and Aqua-MODIS LST for 2016. Once VESPER was fully trained it was used to predict LST over the whole globe for 2019.  Going forward, as a shorthand we will refer to VESPER trained using $VM$ surface physiographic fields as VESPER\_VM. For instance, a VESPER model trained using the surface physiographic fields from V15, we refer to as VESPER\_V15 (see Table \ref{tab:vesper_table} for an explicit definition of all the VESPER models). All VESPER versions are trained with ERA5 fields for 2016 and with main surface physiographic fields V15. Then depending on the version some or all additional surface physiographic fields (see Table \ref{table:definitions}) are added. VESPER’s predictions can be compared to the initial ERA5 skin temperatures and actual Aqua-MODIS LST for 2019 (see Figure \ref{fig:example_model}. Figure \ref{fig:example_model} shows the mean absolute errors (MAE) globally in the VESPER\_V15 LST predictions, relative to the Aqua-MODIS LST along with the corresponding MAE in the predicted skin temperature from ERA5. We can see that VESPER\_V15 was able to learn corrections to ERA5, especially in the Himalayas and sub-Saharan Africa as well as Australia and the Amazon basin, leading to the globally averaged MAE reduction for predicted LST; the MAE relative to  Aqua-MODIS LST, averaged over all grid points, was 3.9K for ERA5 and 3.0K for VESPER\_V15. \newline 
  
 \begin{table*}
 	\begin{tabularx}{\textwidth}{lXXXX}
 		\toprule
 		Model & 2016 atmospheric and surface fields & 2016 main physiographic fields & 2020 main physiographic fields & Additional surface physiographic fields \\
 		\hline
 		VESPER\_V15 & \checkmark & \checkmark & - & - \\
 		VESPER\_V15X & \checkmark & \checkmark & - & \checkmark \\
 		VESPER\_V20 & \checkmark & \checkmark & \checkmark & - \\
 		VESPER\_V20X & \checkmark & \checkmark & \checkmark & \checkmark \\
 		
 		\bottomrule
 	\end{tabularx}
 	\caption{List of input files for different VESPER versions. c.f. Table \ref{table:definitions}}
 	\label{tab:vesper_table}
 \end{table*}
 
 
 
 \begin{figure*}
 	\subfloat[\label{fig:wasserstein_temperature}]{\includegraphics[width=0.48\textwidth]{model_prediction_error.png}} \hspace{1mm}
 	\subfloat[\label{fig:wasserstein_precipitation}]{\includegraphics[width=0.48\textwidth]{ERA_prediction_error.png}}
 	\caption{Mean absolute error (MAE) of LST predictions for 2019 at ~31km resolution based on differences δK (a) between VESPER\_V15 (i.e. VESPER trained with V15 surface physiographic fields) and Aqua-MODIS LST, and (b) between ERA5 skin temperature and Aqua-MODIS LST. It can be seen that VESPER\_V15 managed to learn corrections over regions with complex surface fields such as the Himalayas (lots of orography) sub-Saharan Africa (lots of vegetation) and the Amazon Basin (lots of water + vegetation). } 
 	\label{fig:example_model}
 \end{figure*}


\noindent As the focus of this study is lake-related fields, and lakes occupy only 1.8\% of the Earth’s surface and are distributed very heterogeneously \citep{Choulga2014}, analysis of the results was restricted to areas where there have been significant changes in the surface lake physiographic fields. By ``significant change" we mean a change in any of the surface field when going from V15 to V20 (and to V15X or V20X) of ≥ 10\% (≥ 0.1 for fractional fields); for example if lake or vegetation cover changed from 0.1 in V15 to 0.3 in V20 field set this change is classified as significant. The choice of ≥ 10 \% as a significance cut-off was adopted as it proved to be a good trade off between having a sufficient number of grid points to inspect and the strength of the effect of changing the input field. As the cut-off \% increases less points are selected, albeit with more severe changes to their surface fields, whereas when the cut-off \% decreases more points are selected but it becomes more difficult to disentangle the change in the prediction accuracy from VESPER’s training noise (training noise is discussed below). Alternative cut-off \% were briefly explored, but conclusions of the results remained broadly unchanged. All grid-cells selected for the analysis can be classified according to how the surface fields are updated when going from V15 to V20 (note that categories represent a systematic and consistent update across multiple related fields, and do not include any restrictions on other surface fields apart the ones mentioned): 
\begin{itemize}
	\item \textbf{Lake Updates}. The change in the lake cover \textit{cl} and lake depth \textit{dl} are significant, but the changes in ocean and glacier \textit{glm} fractions are not. This corresponds to grid-cells where lakes have been added or removed. Lake-Ground Updates is a sub-category where additional constraint that the change in the high/low vegetation fractions \textit{cvh/cvl} are not significant is in place. This then corresponds to the exchange of lakes for bare ground, or vice versa.
	\item \textbf{Vegetation Updates.} The change in the high vegetation fraction \textit{cvh} is significant, but the change in lake cover \textit{cl} is not significant. This corresponds to grid-cells where large features like forests and woodlands have been updated, exchanged for bare ground or low vegetation.
	\item \textbf{Glacier Updates}. The change in the glacier cover \textit{glm} is significant. This corresponds to any areas where the fraction of glacier ice has been updated.
\end{itemize}
The VESPER model is trained on 2016 data over the entire globe, and then used to predict LST for 2019. The training of a neural network is inherently stochastic - the same model trained twice with the same data can settle in different local optima and so make different predictions. To make our conclusions robust against this training noise, each VESPER model is in turn trained 4 times. For each MODIS ground truth we then have 4 LST predictions per model. We define the training noise as the standard deviation $\sigma$ in the VESPER predictions for the same input fields i.e. each VESPER\_VX model will have a corresponding training noise $\sigma_{\rm VM}$. To assess the changes of LST predictability due to the use of the updated surface physiographic fields instead of V15 field set (default) we compare the mean absolute error (MAE) between different VESPER models using the a simple metric $\delta_{\rm VM}$:
\begin{equation} 
	\delta_{\rm VM} = \text{MAE}_{\rm VESPER\_VM} - \text{MAE}_{\rm VESPER\_V15} 
\end{equation}
where $M$ represents one of the field set versions V20, V20X or V15X, and $\text{MAE}$ is computed over the whole prediction period of 2019. In turn, the MAE is the error between the prediction of a VESPER model and the Aqua-MODIS LST. A negative $\delta_{\rm VM}$ then indicates that the VESPER\_VM LST prediction is more accurate than the  VESPER\_V15 prediction, and vice versa.
\section{Results}

\subsection{Evaluation of updated lake fields}\label{sec:3}
To understand if there is a way to automatically and rapidly assess the accuracy of updated and/or new surface physiography fields, and if their use in the atmospheric model increase predictability, we can compare the prediction accuracy of different VESPER\_VM models. Generally VESPER’s training noise was confirmed to be smaller than differences in LST predictions by different VESPER configurations, so changes in LST predictability can be meaningfully attributed to the changes in surface physiographic fields. Particular situations where the training noise becomes significant are discussed below. \newline 


As a first attempt lake-related information is assessed, namely lake cover (and land-sea mask and glacier cover as they are used for lake cover generation) and lake mean depth, that were created from scratch using new up-to-date high-resolution input datasets (see Table \ref{tab:datasources}) for the V20 (and V20X) field set; other surface physiographic fields (see Table \ref{table:definitions}) were regenerated from the same input sources as in initial V15 field set but taking into account that lake related fields were changed. In cases when existing in V15 lake cover water was removed in V20, its place could fill high or low vegetation, glacier or bare ground. To analyse results grid-cells were divided into four categories, and each was investigated in detail (see Table \ref{tab:categorisation} for the results aggregated over the whole globe).
\begin{table*}
	\begin{tabular}{ccccccccc}
		\toprule
		\multirow{2}{*}{Category} & \multirow{2}{*}{Number of grid cells} & 	\multicolumn{4}{c}{$\sigma_{\rm VM}$, $K$} &\multicolumn{3}{c}{$\delta_{\rm VM}$, $K$} \\  
		&&V15  & V15X & V20 & V20X & V15X &V20 & V20X  \\
		\hline 
		Lake&1631 & 0.07& 0.02& 0.02& 0.02&  -0.2 & -0.37&-0.37 \\
		Lake-Ground&546 & 0.15 &0.05& 0.04& 0.06 & -0.56 &-0.83& -0.84 \\
		Vegetation&58 & 0.04 &0.1& 0.15& 0.21&  -$4 \times 10^{-3}$&0.04 & -3 $\times 10^{-4}$ \\
		Glacier&1057 & 0.03& 0.08& 0.02& 0.06 & -0.01& -0.22& -0.28  \\
		\bottomrule
	\end{tabular}
	\caption{Globally averaged differences $\delta_{\rm VM}$ between mean absolute error (MAE) of VESPER\_VM  and VESPER\_V15 LST for 2019 at ~31km resolution (where M denotes V15X, V20, V20X field sets) per grid-cell category. Negative $\delta_{\rm VM}$ values indicate increase of LST predictability due to the use of the updated surface physiographic fields instead of V15 field set (default), positive $\delta_{\rm VM}$ values indicate a decrease in the LST predictability and suggests the presence of erroneous information in the surface physiographic fields. Training noise values are generally much smaller than the variance between different VESPER configurations, indicating that changes in LST predictability are mainly due to changes in the surface physiographic fields. The quoted noise is the standard deviation of the prediction errors of Fig. \ref{fig:global_shift_plot}.}
	\label{tab:categorisation}
\end{table*}	
\begin{figure}
	\includegraphics[width=\columnwidth]{global_shift_plot}
	\caption{Distribution of prediction errors in the LST, for each of the 4 grid point categories, for each iteration of V15 and V20. For Lake, Lake-ground and Glacier categories the improvement in V20 relative to V15 is much greater than the intrinsic model noise, with all V20 predictions outperforming all V15 predictions. For the Vegetation category the predictions of V15 and V20 are much more noisy and it is difficult to draw any conclusions for the category as a whole.} 
	\label{fig:global_shift_plot}
\end{figure}


\subsubsection{Category: Lake updates}
\begin{figure}
	\includegraphics[width=\columnwidth]{lakes_histogram_plot}
	\caption{Distribution of prediction errors in the LST for all grid points in the Lake Updates category for VESPER\_V15 and VESPER\_V20.  Each prediction errors is in turn the average of 4 trained iterations of the VESPER model. The predictions of VESPER\_V20 are evidently and improvement over VESPER\_V15.} 
	\label{fig:example_figure_histogram}
\end{figure}
The Lake Updates category shows significant improvements in LST predictability if using V20 field set instead of V15 – prediction accuracy increased globally (over 1631 grid-cells) on average by 0.37K. For the lakes category, the training noise in V20 was generally small $\sigma_{\rm V20} \sim 0.02$ K, with the V15 predictions a little more noisy with $\sigma_{\rm V15} \sim 0.07$ K, but this noise is much less than the improvement - as can be seen in Fig. \ref{fig:global_shift_plot} every V20 iteration significantly outperforms every V15 iteration. In Fig. \ref{fig:example_figure_histogram} we plot the distribution of the mean LST error (averaged across each of the 4 trained VESPER iterations) for all lake grid points, for both V15 and V20. Evidently the V20 field significantly improve the high tail behaviour relative to V15, as well as shifting the median of the distribution to lower errors. Particular regions where the V20 physiographic fields notably improved performance were in Australia and the Aral sea (e.g. Fig. \ref{fig:bitstring_100110}). These are two major regions where ephemeral lakes were removed and inland water distribution made up-to-date, as discussed in Section \ref{sec:surface_physio}. In addition to the areas with a notable improvement in the prediction accuracy, there are some noteworthy regions where the predictions got worse (see red points in Figure \ref{fig:bitstring_100110}) suggesting inaccuracies or lack of information in the updated surface physiographic fields. A few of the most noteworthy grid-cells (see red points highlighted with green circles in Figure \ref{fig:bitstring_100110} and also Figure \ref{fig:lake_sub_categories}) are:
\begin{itemize}
	
		\item \textbf{Northern India.} This grid-cell lies in the state of Gujarat, India, close to the border with Pakistan. Here $\delta_{\rm V20} = +4.21$, with $\sigma_{\rm V15} = 2.54$ and $\sigma_{\rm V20}=0.416$. The lake fraction was increased from 0.59 in V15 to 0.71 in V20 field set, along with the lake depth increase from 2.58m to 3.76m.However, this point lies on a river delta within the Great Raan of Kutch, a large area of salt marshes (see Figure \ref{fig:lakes5}), known for having highly seasonal rainfall, with frequent flooding during the monsoon season and a long dry season. The surface itself also undulates with areas of higher sandy ground known as medaks, with greater levels of vegetation. It is evidently a complex and highly time variable area and additional static fraction of fresh water provided via V20 field set is not enough.
	
	\item \textbf{Salt Lake City, North America.} This grid-cell lies within the Great Salt Lake Desert, just to the west of the Great Salt Lake, Utah, US. Predictions of VESPER\_V20 are worse than VESPER\_V15, with $\delta_{\rm V20} = +2.91$ ( $\sigma_{\rm V15} = 0.26$ and $\sigma_{\rm V20}=0.92$). Whilst the training noise is significant here, it is less than the $\delta_{\rm V20}$ value, and we can see from Fig \ref{fig:lake_sub_categories} that the VESPER\_V20 predictions consistently underperform the VESPER\_V15 predictions. The lake fraction was completely removed from over 0.50 in V15 to 0.00 in V20 field set, meaning that the grid-cell is fully covered with bare ground in V20 field set. Whilst this area primarily is bare ground, satellite imagery also suggests the presence of a presumably highly saline lake (see Figure \ref{fig:lakes3}); in addition area has a large degree of orography and high elevation (∼1300m) which probably further complicates the surface temperature response. A more accurate description that accounts for the seasonality of the surface water and the salinity is necessary here.
	
	\item \textbf{Tanzania}. There are two grid-cells of interest at the centre and northern edge of Lake Natron, which itself lies to south-east of Lake Victoria, in Tanzania. For both these points VESPER\_V20 predictions are less accurate than VESPER\_V15; for the central point ($\delta_{\rm V20} = +2.45$,$\sigma_{\rm V15} = 0.12$ and $\sigma_{\rm V20}=0.81$, see also Figure \ref{fig:lakes1}) the lake fraction was increased from 0.04 in V15 to 0.39 in V20 field set; for the northern edge point ($\delta_{\rm V20} = +1.57$,$\sigma_{\rm V15} = 0.13$ and $\sigma_{\rm V20}=0.51$) the lake fraction was also increased in V20 comparing to V15 field set along with a small decrease ($\sim$0.1) in the low vegetation fraction. However, Lake Natron is a highly saline lake that often dries out, with high temperatures, high levels of evaporation and irregular rainfall. It is a highly complex and variable regime that is not well described by simply increasing fraction of permanent fresh water, and indeed results suggest that with current lake parametrization scheme it may be beneficial to keep the lake fraction low or introduce extra descriptor, e.g. salinity. 

	\item \textbf{Algeria}. This grid point lies in Algeria, at the northern edge of the Chott Felrhir, an endorheic salt lake ($\delta_{\rm V20} = +2.20$,$\sigma_{\rm V15} = 0.41$ and $\sigma_{\rm V20}=0.49$). Similar to the Great Salt Lake Desert, the lake fraction was completely removed from 0.33 in V15 to 0.0 in V20. However, Chott Felrhir goes through frequent periods of flooding where the lake is filled by multiple large wadi, and corresponding dry periods where the lake becomes a salt pan. As with the Great Salt Lake Desert it is also a highly variable, complex area requires additional consideration of the salinity and the seasonality.  
	
	
	\item \textbf{Lake Chad} This grid point contains Lake Chad, a freshwater endorheic lake in the central part of the Sahel ($\delta_{\rm V20} = +1.74$,$\sigma_{\rm V15} = 0.33$ and $\sigma_{\rm V20}=0.98$). Here the lake fraction was modestly reduced from 0.63 to 0.47. However, Lake Chad is again a highly time variable regime with seasonal droughts and wet seasons. It is a marshy wetland area but the vegetation fractions in both V15 and V20 here are zero. Satellite imagery also shows a large fraction of the surface covered by water and vegetation (Figure \ref{fig:lakes11}).
	

	\item \textbf{Al Fashaga} This grid point lies in a disputed region between Sudan and Ethiopia called Al Fashaga, close to a tributary of the Nile ($\delta_{\rm V20} = +0.94$,$\sigma_{\rm V15} = 0.14$ and $\sigma_{\rm V20}=0.29$). The updated V20 fields increased the lake fraction at this point from $0$ to $0.14$. The grid cell contains the Upper Atbara and Setit Dam Complex. However, the dam was only recently completed in 2018 - during the training period the damn was still under construction. Consequently whilst the V20 field may be more accurate at the current time, during the period the model was training the V15 field was more accurate, since the damn was not yet built. 
		
	\item \textbf{Lake Tuz}. This grid cell contains a large fraction of Lake Tuz as well as the smaller Lake Tersakan, saline lakes in central Turkey ($\delta_{\rm V20} = +0.85$,$\sigma_{\rm V15} = 0.25$ and $\sigma_{\rm V20}=0.34$). Here the updated physiographic field effectively removed all lake water, with the lake fraction decreasing from 0.14 to 0.005. Whilst the lake is shallow and does dry out in the summer, there is also a large fraction of surface water present (e.g. Fig \ref{fig:lakes44s}) and it is an over correction to completely remove all lake water at this point.
	
	\item \textbf{Lake Urmia}. This grid cell contains Lake Urmia, which is another saline lake in Iran ($\delta_{\rm V20} = +0.81$,$\sigma_{\rm V15} = 0.12$ and $\sigma_{\rm V20}=0.73$). The updated physiographic fields decreased the lake fraction at this point from 0.77 to 0.39. This was in response to the shrinking of Lake Urmia due to long-timescale droughts and the damming of rivers in Iran. However, this drought broke in 2019 and Lake Urmia is now increasing in size again - satellite imagery now shows a large fraction of the grid cell covered by water (Figure \ref{fig:lakes444s}).
\end{itemize}


%
%	\item  \textbf{Egypt}. Grid-cell contains a section of the Toshka Lakes, lies to the west of the River Nile in the south of Egypt. Lake fraction was completely removed from 0.36 in V15 to 0.00 in V20 field set, along with the lake depth decrease from 25m to 6m \hl{(training noise in VESPERV15 XX, and in VESPERV20 XX)}. However, whilst this is a very dry region, it contains part of Toshka Lakes, a collection of endorheic waterbodies newly formed (and growing) due to overflow from Lake Nasser (see Figure \ref{fig:lakes6}). These lakes are known to be highly time variable, with a periodic seasonality on top of the general increasing lake sizes, and the formation of surrounding wetlands. These lakes rapidly fill and dry out; during the training and validation years of VESPER (along with the decade before) lakes were mostly dry, whereas during the testing year they were filled. 
%	
%\item \textbf{Australia}. Grid-cell contains Lake Blanche, in South Australia (see Figure \ref{fig:lakes2}). Lake fraction was completely removed from 0.44 in V15 to 0.00 in V20 field set, along with lake depth reduction from 5.5m to 1.0m, and low vegetation fraction increase from 0.53 to 0.97. Whilst the removal of ephemeral water is generally accurate for Australia, for this grid-cell it lowers the predictability of VESPERV20 comparing to VESPERV15. However the shift is only minor $\delta_{V20} = +0.03$ and far outweighed by the training noise (0.83, 1.54 for V15 and V20 respectively) so it is difficult to draw any meaningful conclusions. Lake Blanche is a salt lake that lies below sea level within a wetlands system (so will retain some surface water or soil moisture which will influence the temperature response), fairly devoid of any obvious vegetation. V20 field set describes grid-cell as above sea level (same in V15 orography fields) completely dry region covered with short grass (i.e. low vegetation), which is not an accurate description which could contribute to the lack of an improvement in the predictions.

%	\item  \textbf{Afghanistan}. Grid-cell lies in the south-west of Afghanistan, close to the border with Iran. Lake fraction was completely removed from 0.11 in V15 to 0.00 in V20 field set. However, this area in fact has an extensive network of mountain tributaries which feed an ephemeral lake (e.g. see Figure \ref{fig:lakes4}). Most likely there should be some inland water within a year, especially during the rainy season, so complete water removal might be an overcorrection.


%\noindent It is worth mentioning a vast area north-west of Canada where VESPERV20 slightly underperforms VESPERV15 \hl{(V20 averaged over the area is +0.02K; training noise in VESPERV15 XX, and in VESPERV20 XX)}, but it is hard to draw any definitive conclusions – whilst LST predictions for some grid-cells become more accurate, for some – less accurate. For these high latitude regions there is a large uncertainty for lake location (thermokarst lakes emerge due to permafrost thawing, have small area and can quickly disappear) and lake depth which influence water freezing/thawing dates and ice duration. In addition, observations in these regions are more uncertain and have greater errors due to increased cloud cover. Another interesting region is the north-eastern edge of the Caspian Sea, where VESPERV20 underperforms VESPERV15 (V20 averaged over four grid-cells is +0.65K; \hl{training noise in VESPERV15 XX, and in VESPERV20 XX)}. Location is the Astrakhan Nature Reserve (an extensive wetland). In general, lake fraction was reduced and vegetation fraction increased accordingly in V20 comparing to V15 field set. However, it seems that permanent fresh water fraction is not enough to accurately describe the region and additional monthly varying water cover and/or wetland cover should be introduced. \newline 


\noindent The Lake-Ground Updates sub-category, which restricts analysis to only points with no significant change in the vegetation, allows to more clearly see the effect of adding/removing water on/from bare ground. This sub-category shows even larger improvements in LST predictability if using V20 field set instead of V15 (see Table 4) – prediction accuracy increased globally (over 546 grid-cells) on average by 0.83K ($\sigma_{\rm V15} = 0.15$ and $\sigma_{\rm V20}=0.04$, see also Figure \ref{fig:global_shift_plot}). This indicates that whilst the updated lake fields are globally accurate and informative, providing on average over the globe, over a year, nearly an extra Kelvin of predictive performance, the updates to the vegetation fields tamper this performance gain, indicating potential problem with the vegetation fields


%#ake_haver.png
\begin{figure*}[t]
	\includegraphics[width=0.98\textwidth]{updated_lakes_plot}
	\caption{Differences in the prediction error MAE, between VESPER\_V20 and VESPER\_V15, $\delta_{\rm V20}$,for 2019 at ~31km resolution for ‘Lake Updates’ category (i.e. where lake cover changed significantly). Generally, VESPER\_V20 LST predictions are more accurate, for example in the Aral sea and Australia, indicating that V20 field set is informative and accurate. Particular points where VESPER\_V20 LST prediction gets notably worse compared to VESPER\_V15 are highlighted with green circles and discussed in the text.}
	\label{fig:bitstring_100110}
\end{figure*}

%\begin{figure*}
%	\centering
%	\subfloat[Lake Natron, Tanzania \label{fig:lakes1}]{\includegraphics[width=0.45\textwidth]{LakeNatronCentre4.jpg}} \hspace{1mm}
%	\subfloat[Lake Blanche, Australia \label{fig:lakes2}]{\includegraphics[width=0.45\textwidth]{Australia1}} \\
%	\subfloat[Great Salt Lake Desert, Utah\label{fig:lakes3}]{\includegraphics[width=0.45\textwidth]{SLC1.jpg}} \hspace{1mm}
%	\subfloat[Farah Province, Afghanistan\label{fig:lakes4}]{\includegraphics[width=0.45\textwidth]{Afghan1}} \\
%	\subfloat[Gujarat Province, India\label{fig:lakes5}]{\includegraphics[width=0.45\textwidth]{India1.jpg}} \hspace{1mm}
%	\subfloat[Toshka Lakes, Egypt\label{fig:lakes6}]{\includegraphics[width=0.45\textwidth]{Egypt1}}
%	\caption{Satellite imagery of the problematic Lake Updates points highlighted in Fig. \ref{fig:bitstring_100110} where the V20 predictions are worse than the V15 predictions. Generally the updated V20 fields remove water, only considering permanent water. However these regions have highly time variable waters, which are better captured on average by the V15 fields. The images are centred on the grid box coordinates. Note that the lengthscales are different for some images.} 
%	\label{fig:example_test}
%\end{figure*}


\begin{figure*}
	\centering
	\subfloat[Gujarat Province, India\label{fig:lakes5}]{\includegraphics[width=0.45\textwidth]{gujarat_bonus}} \hspace{1mm}
	\subfloat[Great Salt Lake Desert, Utah\label{fig:lakes3}]{\includegraphics[width=0.45\textwidth]{SLC_bonus}} \hspace{1mm} \\
	\subfloat[Lake Natron, Tanzania \label{fig:lakes1}]{\includegraphics[width=0.45\textwidth]{lake_natron_bonus}} \hspace{1mm}
	\subfloat[Lake Tersakan/Lake Tuz \label{fig:lakes44s}]{\includegraphics[width=0.45\textwidth]{lake_tuz}} \hspace{1mm} \\
	\subfloat[Lake Chad \label{fig:lakes11}]{\includegraphics[width=0.45\textwidth]{lake_chad}} \hspace{1mm}
	\subfloat[Lake Urmia \label{fig:lakes444s}]{\includegraphics[width=0.45\textwidth]{lake_urmia}} \hspace{1mm} \\
	\caption{A selection of satellite imagery of some of the problematic Lake Updates points highlighted in Fig. \ref{fig:bitstring_100110} where the V20 predictions are worse than the V15 predictions. Generally the updated V20 fields remove water, only considering permanent water. However these regions have highly time variable waters, which are better captured on average by the V15 fields. The images are centred on the grid box coordinates.} 
	\label{fig:example_test}
\end{figure*}


\begin{figure}
	\includegraphics[width=\columnwidth]{selected_points_shift_plot_new}
	\caption{As Fig. \ref{fig:global_shift_plot} for selected locations in the lakes grid point category where V15 results in worse predictions compared to V20} 
	\label{fig:lake_sub_categories}
\end{figure}


\subsubsection{Category: Vegetation Updates}
The Vegetation updates category, restricts analysis to grid points with significant change to high vegetation cover, where  the high vegetation cover is substituted with either low vegetation or bare ground, and vice versa. For this category the prediction accuracy of V20 decreased globally (over 58 grid-cells only) on average by 0.04K. However, this shift is much smaller than the training noise between successive VESPER iterations ($\sigma_{\rm V15} = 0.04$, $\sigma_{\rm V20} = 0.15$) and so it is hard to make definitive statements about the performance of the updated vegetation physiographic fields as a whole (see e.g. Fig \ref{fig:veg-noise}). The best we can say is that the updated V20 vegetation fields offer no global improvement in the LST prediction accuracy. \newline 

If we isolate our analysis to individual grid points where the training noise is small (highlighted by $*$ points in Fig \ref{fig:veg-noise}) we can discern that there are multiple locations where the high vegetation fraction was decreased (often quite drastically to zero), specifying that there should just be bare ground, but thorough inspection of these areas with satellite imagery revealed that they should in fact be covered with high vegetation (see e.g. Figure \ref{fig:cvh}) and that updating the V20 high vegetation cover was erroneous for these grid-cells. Moreover, for this subset of less noisy grid points, the strength of the drop in LST predictability in VESPER\_V20 comparing to VESPER\_V15 is approximately linearly dependent to the degree of reduction in high vegetation fraction, when the vegetation is replaced with bare ground (i.e. $\delta_{\rm V20}$ is maximally positive when the grid-cell that was fully covered with forest becomes fully covered with bare ground – high vegetation cover is reduced to zero). These erroneous grid-cells in V20 vegetation fields are likely to appear during the interpolation. The errors in these regions will in turn corrupt the LST predictions and mitigate the gain from a more accurate representation of the lake water. The majority of grid cells in this category (57/58) are modified in this way where the high vegetation fraction is severely reduced, however due to the large degree of training noise and the small number of points, it is difficult to draw any definitive conclusions for the category as a whole.
	\begin{figure}[h!]
	\subfloat[\label{fig:cvh1}]{\includegraphics[width=0.48\textwidth]{siberut_hr.jpg}} \\
	\subfloat[\label{fig:cvh2}]{\includegraphics[width=0.48\textwidth]{NewZealandVeg.jpg}}
	\caption{Satellite imagery of grid-cells in (a) Siberut Island, Indonesia and (b) South Island, New Zealand. For both grid-cells according to the updated V20 field set there should be no vegetation, just bare ground. VESPER identified these erroneously updated areas.} 
	\label{fig:cvh}
\end{figure}

\begin{figure}
	\includegraphics[width=\columnwidth]{veg_plot_noise}
	\caption{Distribution of prediction errors in the LST, for VESPER\_V15 and VESPER\_V20, for all 58 grid points in the vegetation category. There is evidently a large degree of noise, with predictions from both generations of VESPER model highly overlapping. Points with reduced training noise are highlighted with a $*$.}
	\label{fig:veg-noise}
\end{figure}


\subsubsection{Category: Glacier Updates }
The Glacier Updates category in general shows improvement in LST predictability in VESPER\_V20 comparing to VESPER\_V15 (see  Table  \ref{tab:categorisation})  –  prediction  accuracy  increases  globally  (over  1057  grid-cells)  on  average  by  0.22K  ($\sigma_{\rm V15} = 0.03$, $\sigma_{\rm V20} = 0.02$), most notably around the Himalayas, the land either side of the Davis strait, as well as British Columbia and the Alaskan Gulf. Analogous to the Lakes Updates category whilst the introduction of the V20 glacier cover generally improves LST predictions, there is a small selection of grid points where the prediction gets worse. These are heavily concentrated  in  the  southern  hemisphere,  in  particular  on  the  south-western  edge  of  South  America  and  the  South Shetland Islands (which lie closer to Antarctica), and some parts of the Himalayas. This deterioration in performance in these areas is not due to erroneous update of V20 glacier cover, but related to the Aqua-MODIS data (i.e. sparse availability due to clouds, and less certain due to orography, see Figure \ref{fig:modis_plot_1}). Consequently, VESPER finds it difficult to make accurate predictions in this region and for these points there is often a large degree of training noise, with considerable overlap between VESPER\_V15 and VESPER\_V20. If grid- cells with scarce amount of Aqua-MODIS observations (i.e. mean number of Aqua-MODIS observations per day over the year per ERA5 grid-cell is >50) are removed from the analysis then the worst performing grid-cells become excluded, yet a few areas where VESPERV20 underperforms VESPERV15 remain. For  example, there is a grid-cell in Chilean Patagonia that contains the Calluqueo Glacier, close to Monte San Lorenzo where $\delta_{\rm V20} = 2.49$ ($\sigma_{\rm V15} = 0.38$,$\sigma_{\rm V20} = 0.62$). This grid-cell has been updated in V20 field set comparing to V15 by strongly increasing glacier cover from 0.0 to 0.44), decreasing low vegetation cover (from 0.22 to 0.12) and high vegetation cover (from 0.16 to 0.09) modestly decreasing lake cover (from 0.02 to 0.007). According to satellite imagery (see Figure \ref{fig:glacier1}) the glacier only occupies a small fraction of the overall grid-cell, and the updated glacier cover may have been an over correction. Moreover, this is an complex orographic area with snowy mountain peaks at high altitude and deep valleys, therefore the temperature response due to the glacier feature could be atypical compared to e.g. the Alaskan Gulf or the Davis straight. There is also substantial vegetation cover in the valleys that may not be being properly described. A similar point is in the  Chilean Andes (see Figure \ref{fig:glacier2}),  by the Juncal Glacier with $\delta_{\rm V20} = 1.26$ ($\sigma_{\rm V15} = 0.68$,$\sigma_{\rm V20} = 0.29$). Here V20 glacier cover was increased to 0.25 compared to 0.00 in V15. Again, this is may have been an over correction, as the glacier constitutes only a  small fraction of the grid cell. As with the Calluqueo Glacier this is also an area with lots of orography and so could have an atypical temperature response. For both of these points VESPER managed  to identify potential inaccuracies in updated glacier cover, and once again proved itself as a useful tool for quality control of surface physiographic fields. 
	\begin{figure}[h!]
	\subfloat[\label{fig:glacier1}]{\includegraphics[width=0.48\textwidth]{pataginia2}} \\
	\subfloat[\label{fig:glacier2}]{\includegraphics[width=0.48\textwidth]{Andes1.jpg}} 
	\caption{Satellite imagery of (a) Calluqueo Glacier, Patagonia, and (b) Juncal Glacier, Chile. In the updated V20 field set, the assumption for region (a) is almost half ice cover with little vegetation, for region (b) is quarter covered with glacier; these assumptions seem to be insufficiently accurate or informative, as identified by VESPER.
	} 
	\label{fig:glacier}
\end{figure}

% The Bering glacier is known to be a time varying (i.e. varies in size over the course of the season), and satellite imagery of the region (see Figure \ref{fig:glacier1}) does give this impression; on longer timescales glacier exhibits a general reduction in its surface area (i.e. retreat of the terminus) over time, coupled with periodic surges in the glacier flow around every 20 years \citep{beiringglacier}. It is therefore a complex region with even visible presence of low vegetation (see Figure 10a), so assuming it’s constantly almost fully ice covered with no vegetation  seems  as  an  overcorrection.  

\subsection{Evaluation of new lake fields: Monthly water \& salt lakes}


From  examples  above  it  is  evident  that  VESPER  enables  the  user  to  quickly  identify  regions  where  the  update  to  surface physiographic fields was beneficial (e.g. Aral Sea) and where it was not (e.g. Lake Natron, high vegetation updates). In turn, areas where LST predictions do not improve as expected can be inspected and erroneous or sub-optimal representations of the surface  physiographic  fields  identified.  This  then  provides  key  information  on  how  and  where  to  introduce  additional corrections to better represent these more challenging or complex regions. Further some of these problematic areas are explored in more details and additional surface physiographic fields introduced with help of VESPER.



Particular regions where VESPER was struggling to make LST predictions – especially with the updated V20 field set which only include permanent water – were either areas with a large degree of temporal variability (e.g. lakes which flood and dry out periodically) or else areas with saline rather than freshwater lakes. Clearly if the size, shape and depth of a lake are changing over the course of the year, these are going to be hugely significant factors in modelling the lake temperature response. Similarly, saline lakes behave very differently to freshwater lakes since increased salt concentrations affect the density, specific heat capacity, thermal conductivity, and turbidity, as well as evaporation rates, ice formation and ultimately the surface temperature. These two properties of time variability and salinity are often related; it is common for saline lakes to flood and dry out over the course of the season, which naturally also affects the relative saline concentration of the lake itself.
Currently, neither VESPERV15 or VESPERV20 have any information regarding the salinity of the lakes or their time variability. Indeed, FLake is specifically a fresh water lake model! This information can be introduced by including a global saline lake cover and monthly varying lake cover as additional VESPER’s input features, and use VESPER to rapidly assess accuracy of these new surface physiography fields and if their use in the model increase LST predictability. V20X field set is the same as V20 but with additional saline lake cover and difference between V20 static lake cover and monthly varying lake cover (12 maps in total); VESPERV20X is a neural network regression model trained on 2016 data with additional surface physiography fields, and used for LST predictions in 2019 (for comparison results with VESPERV15 see Table 4).

\subsubsection{Category: Lake updates}

For the Lake Updates category shows globally no significant difference in LST predictability if using V20X field set instead of V20 comparing to V15, for the Lake-Ground Updates category – LST predictability has slightly decreased (from V20=-1.12K to V20X=-1.09K, \hl{although the difference is rather small and within the training noise} (see Table \ref{tab:categorisation}). Over problematic grid-cells discussed previously VESPERV20X LST predictability is significantly improved comparing to VESPERV20 (see Table \ref{tab:categorisation2}). 




\begin{table*}
	\begin{tabular}{clccccccc}
		\hline
		\multirow{2}{*}{Category} & \multirow{2}{*}{Grid-cells/location} & 	\multicolumn{4}{c}{$\sigma_{\rm VM}$, $K$} &\multicolumn{3}{c}{$\delta_{\rm VM}$, $K$} \\  
		&&V15  & V15X & V20 & V20X & V15X &V20 & V20X  \\
		\hline 
		\multirow{9}{*}{Lake}&Gujarat Province, India& 2.544 &1.122 &0.416 &1.039 & -1.255 &4.21& 5.243 \\
		&Great Salt Lake Desert, Utah&0.259 &0.413 &0.92 &0.617 & -0.182 &2.915 &0.248\\
		&Lake Natron centre, Tanzania&0.12 &1.479 &0.813& 0.532 & 1.354& 2.449& 2.608 \\
		&Lake Natron north, Tanzania&0.129 &0.374 &0.512& 0.175 & 0.718 &1.572 &1.235 \\
		&Chott Felrhir&0.41 &0.57& 0.49& 0.578 & 0.341 &2.198& 0.726 \\
		&Lake Chad&0.33 &1.212 &0.978 &0.959 & 0.292 &1.738 &0.029\\
		&Al Fashaga&0.138 &0.084 &0.288 &0.424 & -0.24& 0.935 &1.063 \\
		&Tersakan Lake&0.254 &0.201& 0.34 &0.375 & -0.002 &0.851 &0.994 \\
		&Lake Urmia&0.123& 0.537 &0.727 &0.318 & 0.537 &0.815 &0.22 \\
		\hline 
		Lake-ground&-& &  &  &  & & &   \\
		\hline
		Vegetation&& &  &  &  & & &   \\
		\hline 
		\multirow{2}{*}{Glacier}&Calluqueo Glacier, Patagonia&- &-&- &- & -&- &-\\
		&Juncal Glacier, Chilean Andes &-& -& - &- & - &-& - \\
		\bottomrule
	\end{tabular}
	\caption{Globally averaged differences VM between mean absolute error (MAE) of [VESPER\_VM LST predictions minus Aqua-MODIS LST] and MAE of [VESPER\_V15 LST predictions minus Aqua-MODIS LST] for 2019 at ~31km resolution (where M denotes V15X, V20, V20X field sets) for certain locations per grid-cell category. VESPER\_V20X LST predictability is consistently higher comparing to VESPER\_V20 at these locations, but for some locations, e.g. Lake Natron, is lower comparing to more basic VESPER\_V15. Conversely, VESPER\_V15X LST predictability globally is lower comparing to VESPER\_V20 and VESPER\_V20X, but can be higher for certain locations, where the updated V20 field set is less accurate.}
	\label{tab:categorisation2}
\end{table*}
\noindent For Lake Blanche, use of V20X field set reduces the LST prediction error by 2.43K compared to use of V20. This is in spite of the fact that current saline lake cover do not identify Lake Blanche as a salt lake, and so all the improvement in the prediction is from the additional information from the monthly lake maps. Same is for the salt marsh grid-cell in Northern India (not included in the saline lake cover), where LST prediction error is reduced by 2.19K only due to monthly lake maps information. For two freshwater grid-cells over Toshka Lakes in Afghanistan monthly lake maps provide sufficient information to allow for a marked improvement by 2.04K and 2.15K respectively \hl{(training noise in VESPER\_V15 XX, and in VESPER\_V20 XX )}. This is particularly notable since the size of the monthly lake corrections is small for these Afghanistan and Toshka Lakes grid-cells, i.e. +0.05 and +0.00 \hl{(NOTE - before here was 0.001 - suggest to write not mean over the year, but min and max value)}. However, under the updated V20 lake cover both of these areas have had all water removed and so adding in just a small amount of time variable water allows for much more accurate predictions. This example illustrates how VESPER both can identify inaccurate fields and quantify the value of updated fields, as well as emphasizing the importance of time variable lake fields more generally. For points where the saline maps do specify that the underlying lakes have salt water – Lake Natron and Salt Lake Desert – it is not possible to disentangle whether the gain is due to the saline maps or the monthly maps. The centre of Lake Natron exhibits a particularly notable improvement by 2.6K \hl{(training noise in VESPER\_V15 XX, and in VESPER\_V20 XX)}, whilst for the grid point on the northern edge the gain is more modest at 0.12K \hl{(training noise in VESPER\_V15 XX, and in VESPER\_V20 XX)}. This is likely due to the fact that the updated monthly maps provided much stronger corrections at the centre of the lake (mean monthly lake cover correction 0.13) than at the northern edge (mean correction 0.02). 


For the grid point at the Great Salt Lake Desert, the improvement is 2.06 K \hl{(training noise in VESPER\_V15 XX, and in VESPER\_V20 XX)} again with a strong correction from the monthly lake maps (mean value 0.16) and the salt maps (mean value 0.56). This improvement is to be expected given the known strong salinity and time variability in the region, and so it is a nice confirmation to have these updated fields verified by VESPER. It is also notable that the variation in the monthly lake maps at this point is very large, with a standard deviation in the lake fraction over 12 months of 0.18. At the start of the year the corrections from the monthly maps are very large, then as the year progresses the magnitude of the corrections generally decreases as the lake dries out. Such a large variation is again difficult to ever capture with a static field. \newline 

\noindent Other regions of note that we have mentioned previously are the Northwest Territories and the Nunavut province in Northern Canada where the V20 model underperformed relative to V15, with δV20 = +0.02 K. The introduction of the monthly lake maps modestly improves the predictions in this area, with δV20X = −0.03K. In these high latitude regions one might expect some time variability due to freezing and thawing of the lake surfaces, and the addition of the monthly lake maps to the model then provides some of this time variable information, allowing for improved predictions. Whilst this is an improvement, the effect is modest; it is generally difficult to get quality observations at high latitudes, especially during the cold season, due to increased cloud cover. Therefore whilst VESPER can say that the addition of the monthly lake maps does improves the predictions in these regions, for improved performance cloud independent data should be used. Additionally, the corrections from the monthly lake maps are small in these regions, with a mean correction of 0.02 and a generally small variance; in actuality time variable fields with greater variance over the year may be more accurate. Due to the freezing and thawing, improving ice on/off date prediction by the lake parametrisation should help better describe the seasonality and variance.
It is worth emphasising that whilst the V20 and V20X models are improvements over V15 globally, and V20X is generally an improvement over V20 for these problematic points, there are regions where neither V20 or V20X outperform V15 (δM is always positive), such as Lake Natron and Northern India. Given all the extra information provided to the more advanced models this is unusual, unless the additional information is erroneous in these regions or else the temperature response is completely atypical to the rest of the globe and the additional information is not predictive in these regions. To explore this hypotheses we train one further model, V15X. This is analogous to V20X, being simply the V15 model with the additional monthly maps and salt lake fields included. Importantly it does not have the updated correction fields from V20. Globally, this model performs worse that the V20 models, as we might expect - for example in the Lake Updates category δV15X = −0.25K compared to δ20X = −0.45 K. However, V15X does perform well at these problematic points (see Table \ref{tab:categorisation2}). For both the Lake Natron grid points V15 outperforms V20X, suggesting that at this location the V20 fields are generally less accurate than the V15 fields. V15X however underperforms relative to V15 which also indicates that the monthly maps and the salt lakes are either inaccurate at this location, or that the temperature response of Lake Natron is highly atypical. For Northern India, the performance of the V15 model is particularly striking; whilst the V20 and V20X models struggled to make more accurate predictions than V15, V15X decreases the average prediction error by nearly 6K. This again indicates that for this point the V20 fields are less accurate than V15. Similarly for the Great Salt Lake Desert, δV20 = 1.78 K, δV20X = −0.28 K but δV15X = −0.86 K, which suggests that whilst the monthly lake maps and the salt lake fractions are accurate and informative in this area, the static V20 fields are not. These examples illustrates again how VESPER can identify particular regions where the fields are inaccurate, as well as emphasising the need more generally for accurate descriptions of seasonally varying inland water and saline lake maps in Earth system modelling.


\subsubsection{Category: Vegetation Updates}
Whilst the Vegetation Updates category explicitly deals with areas where the lake fraction does not change when going from V15 to V20, many of the grid points in this category do contain some kind of waterbody, often lying close to the coast or else containing lakes or large rivers. Information on the salinity and temporal variability of these water bodies can then influence the prediction accuracy. By providing the additional information in V20X, the mean δM is reduced from δV20 = +0.049K to δV20X = 0.005K. This performance is gained despite the known errors for some of the grid boxes in the cvh vegetation updates (e.g. Figure 7), again demonstrating the importance of salinity and seasonally varying water. The V15X model is less performant than V20X, with δV15X = 0.11K since there are some grid boxes in this category where the updated V20 fields are accurate and valuable if augmented by monthly variability. However if we consider just the worst performing grid points where δV20 > 1 K then the mean values are δV20 = 2.0 K, δV20X = 0.49 K and δV15X = 0.21K. This again demonstrates how the cvh fields have been erroneously updated for a small selection of grid points in V20.



\subsubsection{Category: Glacier Updates}
We would expect the additional information provided by V20X to be particularly effective for glacial grid points. Glacier ice is naturally found next to waterbodies which freeze and thaw over the year, and the salinity of water will also influence this freezing. Therefore accurate additional information from the monthly lake maps and the saline maps should prove useful in these more time variable regions. This is indeed what we observe with the mean delta going from δV20 = −0.13K to δV20X = −0.24K. Considering the two problematic points that we discussed previously, in the Alaskan Gulf the prediction accuracy relative to V15 has improved from δV20 = +2.16 K to δV20X = +1.00 K, whilst for the Juncal Glacier the prediction accuracy has also improved, with δV20X decreasing to +1.88 K. Despite this improvement, again for both of these points the prediction accuracy still lags behind V15. This is on account of the V20 fields being insufficiently accurate in these areas, as has been discussed. Neither of these grid points correspond to saline lakes or have a significant time variability in the monthly lake fractions and so are also not improved by a V15X model.


\subsubsection{Timeseries}
Thus far we have been focusing mainly on the δM metric averaged over the entire year of the test set. It is also of interest to explore how the prediction error for each of the 3 models varies with time. This is demonstrated in Fig \ref{fig:timeseries} for each of the 4 updated categories that we have discussed. \newline 

\noindent For the Lake Updates and Lake-Ground Updates categories we can see that all the model predictions track the same general profile, with the error peaking in the northern hemisphere summer months. This is a result of FLake modelling being least accurate during the summer as the lake is not fully mixed and so the mixed layer depth for lakes is too shallow, resulting in skin temperatures with larger errors. Conversely, in the autumn and spring the lake is fully mixed and predictions have the smallest errors compared with observations. A clear hierarchy of models is evident; the V20/V20X models consistently outperform the V15 model across the year. This again is solid evidence, highlighted by VESPER, of the value of the updated fields both static and seasonally varying. We mentioned previously how the annually and globally averaged δM values for the Lake Updates category were highly comparable for V20 and V20X, despite V20X significantly improving the worst behaving points. We can see from the top panel in Figure 9 that the V20X model is a systematic improvement on V20 from around April onwards, but at earlier times in the year V20 outperforms V20X. This is likely for two reasons. Firstly, the monthly lake maps are in fact a climatology and therefore insufficiently precise to detect the exact ice on/off dates during the winter months, where we have a large number of grid points at high latitudes which will be subject to freezing, nullifying any time variability. Secondly, due to the accuracy of the lake mean depth which strongly drives the ice on-dates due to its influence on the heat capacity of the lake. During the warmer months lakes thaw, the monthly maps are more accurate, as the thawing of lake ice is mainly connected to the atmospheric conditions, not the lake depth, and so the information contained in them can be used to make more accurate predictions. The Lake-Ground Updates timeseries broadly follows the same general profile as Lake Updates, but the errors are larger - those grid points where the lakes have been replaced with bare ground were particularly poorly described in V15. Additionally, for Lake Updates we see two sharp decreases in the prediction error during ∼ April and September, which are not as strongly reflected in Lake-Ground. This is due to the geographic location of the grid points in each of the two categories; for the Lake Updates category the grid points are located primarily in the boreal zones and so are subject to freezing and thawing over the course of the year leading to a strong seasonality due to the lake mixing that we have discussed. The sharp drop in April corresponds to a time where the lakes are unfrozen and fully mixed. However the lakes in the Lake-Ground sub-category are less concentrated and much more evenly distributed over the globe and so do not exhibit such a strong seasonality. \newline 

\noindent Examining the timeseries for Vegetation Updates, whilst there is a large degree of variability, we again see the trend previously discussed whereby the V20 fields make the predictions systematically worse across the entirety of the test year. The introduction of the monthly lake maps in V20X compensates for the erroneous V20 vegetation fields - the V20X predictions are generally worse than V15 at the start and end of the year, but better in the middle. This is due to the fact that the majority of the points in the Vegetation Updates category are in climate zones which have pronounced rainy and dry seasons e.g. Indonesia, the Amazon. At the start of the year during the wet season there is lots of precipitation and the static V15 fields are generally more accurate. As the rains abate and the dry season starts the V15 lake fields are underestimates which are then improved through the introduction of additional water via the monthly lake maps.
For Glacier updates we can separate grid points into the northern and southern hemispheres. We again consider just those points where the number of MODIS observations at a given instant in time, per ERA data point is greater than 50. For the northern hemisphere the familiar hierarchy of models is recovered, with the V20X model generally outperforming V20, which in turn generally outperforms V15. The errors peak for all models in the summer, again due to the lakes not being fully mixed. There is also an uptick in the prediction error for all models during the winter when the freezing is greatest - this indicates how ice cover can strongly influence the land surface temperature response. For the southern hemisphere the story is different. The errors are smallest during the middle of the year when we expect the freezing to be greatest. During the spring and autumn the errors are largest - this is correlated with a decrease in the number of observations suggesting that this is due to poorer data quality due to cloud cover. In the summer when the weather is clearer the errors start to decrease again. Given this variation in the data quality due to cloud cover it is difficult to draw any strong conclusions, and again for stronger performance cloud independent data should be used. What is obvious for the southern hemisphere glacier grid points is that the V20 and V20X models struggle to improve on V15, unlike in the northern hemisphere. This suggests that the updated V20 fields are still insufficiently accurate for southern latitudes.
We have also discussed previously particular grid points that will likely show a large degree of temporal variability or the lakes are saline and as a consequence the static V15/V20 fields struggle to make accurate predictions (e.g. Table \ref{tab:categorisation2}). In Figure \ref{fig:timeseries_stacked} we present timeseries for two of these points: Lake Natron in Tanzania and Gujarat Province, India. Both these points were discussed in Sections 3.1.1 and 3.2.1. We can see that for these two selected points the hierarchy of models no longer holds. Whilst there is a large degree of variability, and there is no clear separation between models that we get when averaging over all grid points as in Fig 9, generally it can be seen that the V20 model performs the worst, indicating that the updated fields are not accurate in these regions. For Lake Natron the V20/V20X models are significantly worse throughout almost the entire year. The updated models - which specify a much larger lake fraction than in V15 - perform well at the beginning and start of the year which tend to be the wettest months at Lake Natron. However, during the summer as the lake dries out the errors grow significantly. This indicates again that the updated V20 fields are in fact over-corrections for this area. Similarly, whilst the V15X model is a significant improvement over V20/V20X - since it does not have these inaccurate fields - it is still less performant than the basic V15 again due to the additional water that V15X specifies. Together this strongly indicates that there is little surface water at Lake Natron during 2019. \newline 

\noindent For Gujarat Province in Northern India the story is different. Now the V20 model is systematically worse than V15 over the entire year, indicating that the static V20 fields are less accurate than the V15 fields. The V20X model shows a strong time variability, with the errors being smallest in the summer which is the wet season in Gujarat and largest in the winter which is the dry season. This suggests that the monthly maps are most accurate during the summer, providing extra information which is missing from V15/V20, but may be overestimates during the winter. The V15X model has a notably strong performance, outperforming the other models almost every month. This again is further evidence of the inaccuracy of the V20 fields and the value of the time-variable monthly water information.

	\begin{figure}
	\includegraphics[scale=0.2]{mega_stack_ns.png}
	\caption{Mean prediction error in the surface temperature $\bar{\Delta} K$, averaged over all grid points, for each of the 3 models over the course of the test year for (\textit{top panel}) Lake Updates, (\textit{second panel}) Lake-Ground Updates, (\textit{third panel}) Vegetation Updates, (\textit{fourth panel}) Glacier Updates, northern hemisphere and (\textit{bottom panel}) Glacier Updates, southern hemisphere. For the Glacier Updates category we again exclude grid points where the number of MODIS observations per ERA data point is less than 50.  For the Lake categories, all models follow the same general profile, with the V20X model generally outperforming the V20 model over the year, which in turn outperforms the V15 model. The value of the additional V20 correction fields and the V20X monthly lake maps and salt lake maps, is evident. \hl{TK: Comment from MC re percentiles}}
	\label{fig:timeseries}
\end{figure}


	\begin{figure}
	\includegraphics[scale=0.2]{stacked_timeseries_lakes_new.png}
	\caption{Variation in the prediction error for the grid points at Lake Natron, Tanzania (top panel) and Gujarat Province, India (bottom panel). There is a large degree of variability, but for Lake Natron the V20 and V20X models are generally less performant than V15 and V15X, indicating that the updated V20 fields are less accurate here. The augmented models with saline and monthly lake maps outperform those without, indicating the value of these fields in these regions.} 
	\label{fig:timeseries_stacked}
\end{figure}



\section{Discussion} \label{sec:discussion}
We have seen how VESPER can quantitatively evaluate the value of updates to the lake surface parametrisation as well as identifying areas where the updates are inaccurate. For the former VESPER was able to show that the major regions where the lake surface parametrisation fields were updated - such as the Aral sea - enjoyed more accurate predictions, which verifies both the accuracy of the fields and their information content with respect to predicting skin temperatures. For the latter VESPER was able to identify grid points where the predictions became worse with the updated fields, indicating that the updated fields were in fact less accurate. More generally we have also seen how detailed knowledge of surface water fields (e.g. up to date permanent water distribution, seasonal water distribution, salt lake distribution, etc.) can notably improve the accuracy with which the skin temperature can be modelled, e.g. grid points with significant updates (i.e. where the field has changed by ≥ 10 \%) to the lake fields show a mean absolute error reduction of skin temperature globally of 0.45K (Table 2). \newline 

There are multiple possible further extensions of this work. We have not currently included the errors on the MODIS observations into the VESPER model. During the “matching-in-space" step relating the ERA and MODIS data (Section 2.2), it could be a worthwhile extension to weight the averaged MODIS points by their corresponding errors (e.g. Fig. X) when deriving a single MODIS observation for a given ERA grid point. This would then provide a more accurate and confident representation of the true surface temperature at a particular space-time point. Due to the inherent stochasticity of training a model it is also possible for different models to settle in different local minimas i.e. the network variance. It would also be desirable to train an ensemble of models (“ensemble learning") and combine the predictions from multiple models to reduce this variance. We have focused here primarily on hydrological applications, our primary concern being the ability to evaluate the parametrised water body representation, however the method would work generally for any updated fields that we want to assess. Extension to non-lake hydrological fields like wetland extent or river bathymetry model parameters, or even non hydrological fields such as orography would be an interesting further development. The development of a more mature, integrated pipeline for automatically evaluating updated parametrisations could also be a worthwhile pursuit. Another natural extension of this work which may prove fruitful in the enterprise for improved parametrised representation of water bodies is to invert the problem and treat VESPER as a function to optimise. That is to say, VESPER can be thought of as a function which takes some inputs - in this case a lake parametrisation - and returns a loss metric i.e. how accurate the predictions are compared to the test set. Given this loss metric it may then be possible to vary the inputs and use standard optimisation techniques to learn the optimal parametrisation. Whilst this may be an expensive technique as there are effectively two nested models over which to optimise (for every optimisation step in the higher model, one must train the VESPER network from scratch) it could be possible given appropriate hardware or with reduced data focusing just on targeted locations (e.g. “What is the best way to represent the lakes in this area?"). The loss gradient information can also be used to tune individual features, informing whether an input variable should be larger or smaller.


\section{Conclusion}\label{sec:conclusion}
Weather and climate modelling rely on accurate, up-to-date descriptions of surface fields, such as inland water, so as to provide appropriate boundary conditions for the numerical evolution. Lakes can significantly influence both weather and climate, but sufficiently  accurate  representation  of  lakes  is  challenging  and  the  natural  changes  in  water  bodies  mean  that  these representations  need  to  be  frequently  updated.  A  new  method  based  on  a  neural  network  regressor  for  automatically  and quickly verifying the updated lake fields - VESPER - has been presented in this work. This tool has been deployed to verify the recent updates to the FLake parametrisation, which include additional datasets such as the GSWE and updated methods for determining the lake depth from GLDBv3. The updated parametrisation fields were shown globally to be an improvement over the original fields; for a subset of grid points which have had significant updates to the lake fields, the prediction error in the skin temperature decreased by 0.45K. Conversely, VESPER also identified individual grid points where the updated lake fields were less accurate, enabling these points to subsequently be corrected, such as losing forests to bare ground leading to errors of 1.1K. Multiple further extensions of this work, including extension to non lake fields and the development of a more mature integrated pipeline have been discussed.





\clearpage
\newpage
\mbox{~}





	
	


	

%\section{Code}
\codeavailability{The code used in constructing VESPER, including the methods for joining the ERA and MODIS datasets and the construction of the neural network regression model is open-sourced at \url{https://github.com/tomkimpson/ML4L}}


%\section{Acknowledgments}





%\conclusions  %% \conclusions[modified heading if necessary]
%TEXT

%% The following commands are for the statements about the availability of data sets and/or software code corresponding to the manuscript.
%% It is strongly recommended to make use of these sections in case data sets and/or software code have been part of your research the article is based on.

%\codeavailability{TEXT} %% use this section when having only software code available


%\dataavailability{TEXT} %% use this section when having only data sets available


%\codedataavailability{TEXT} %% use this section when having data sets and software code available

%
%\sampleavailability{TEXT} %% use this section when having geoscientific samples available
%
%
%\videosupplement{TEXT} %% use this section when having video supplements available


%\appendix
%\section{}    %% Appendix A
%
%\subsection{}     %% Appendix A1, A2, etc.
%
%
%\noappendix       %% use this to mark the end of the appendix section. Otherwise the figures might be numbered incorrectly (e.g. 10 instead of 1).

%% Regarding figures and tables in appendices, the following two options are possible depending on your general handling of figures and tables in the manuscript environment:

%% Option 1: If you sorted all figures and tables into the sections of the text, please also sort the appendix figures and appendix tables into the respective appendix sections.
%% They will be correctly named automatically.

%% Option 2: If you put all figures after the reference list, please insert appendix tables and figures after the normal tables and figures.
%% To rename them correctly to A1, A2, etc., please add the following commands in front of them:

%\appendixfigures  %% needs to be added in front of appendix figures

%\appendixtables   %% needs to be added in front of appendix tables

%% Please add \clearpage between each table and/or figure. Further guidelines on figures and tables can be found below.



\authorcontribution{All the authors contributed equally to the work.Tom Kimpson wrote the manuscript with contributions from all other authors.} %% this section is mandatory

\competinginterests{The authors declare that they have no conflict of interest.} %% this section is mandatory even if you declare that no competing interests are present

%\disclaimer{TEXT} %% optional section

\begin{acknowledgements}
This project has received funding from the European Research Council (ERC) under the European Union’s Horizon 2020 research and innovation programme (Grant No 741112).

\end{acknowledgements}




%% REFERENCES

%% The reference list is compiled as follows:

%\begin{thebibliography}{}
%
%\bibitem[AUTHOR(YEAR)]{LABEL1}
%REFERENCE 1
%
%\bibitem[AUTHOR(YEAR)]{LABEL2}
%REFERENCE 2
%
%\end{thebibliography}

%% Since the Copernicus LaTeX package includes the BibTeX style file copernicus.bst,
%% authors experienced with BibTeX only have to include the following two lines:
%%
 \bibliographystyle{copernicus}
 \bibliography{refs.bib}
%%
%% URLs and DOIs can be entered in your BibTeX file as:
%%
%% URL = {http://www.xyz.org/~jones/idx_g.htm}
%% DOI = {10.5194/xyz}


%% LITERATURE CITATIONS
%%
%% command                        & example result
%% \citet{jones90}|               & Jones et al. (1990)
%% \citep{jones90}|               & (Jones et al., 1990)
%% \citep{jones90,jones93}|       & (Jones et al., 1990, 1993)
%% \citep[p.~32]{jones90}|        & (Jones et al., 1990, p.~32)
%% \citep[e.g.,][]{jones90}|      & (e.g., Jones et al., 1990)
%% \citep[e.g.,][p.~32]{jones90}| & (e.g., Jones et al., 1990, p.~32)
%% \citeauthor{jones90}|          & Jones et al.
%% \citeyear{jones90}|            & 1990



%% FIGURES

%% When figures and tables are placed at the end of the MS (article in one-column style), please add \clearpage
%% between bibliography and first table and/or figure as well as between each table and/or figure.

% The figure files should be labelled correctly with Arabic numerals (e.g. fig01.jpg, fig02.png).


%% ONE-COLUMN FIGURES

%%f
%\begin{figure}[t]
%\includegraphics[width=8.3cm]{FILE NAME}
%\caption{TEXT}
%\end{figure}
%
%%% TWO-COLUMN FIGURES
%
%%f
%\begin{figure*}[t]
%\includegraphics[width=12cm]{FILE NAME}
%\caption{TEXT}
%\end{figure*}
%
%
%%% TABLES
%%%
%%% The different columns must be seperated with a & command and should
%%% end with \\ to identify the column brake.
%
%%% ONE-COLUMN TABLE
%
%%t
%\begin{table}[t]
%\caption{TEXT}
%\begin{tabular}{column = lcr}
%\tophline
%
%\middlehline
%
%\bottomhline
%\end{tabular}
%\belowtable{} % Table Footnotes
%\end{table}
%
%%% TWO-COLUMN TABLE
%
%%t
%\begin{table*}[t]
%\caption{TEXT}
%\begin{tabular}{column = lcr}
%\tophline
%
%\middlehline
%
%\bottomhline
%\end{tabular}
%\belowtable{} % Table Footnotes
%\end{table*}
%
%%% LANDSCAPE TABLE
%
%%t
%\begin{sidewaystable*}[t]
%\caption{TEXT}
%\begin{tabular}{column = lcr}
%\tophline
%
%\middlehline
%
%\bottomhline
%\end{tabular}
%\belowtable{} % Table Footnotes
%\end{sidewaystable*}
%
%
%%% MATHEMATICAL EXPRESSIONS
%
%%% All papers typeset by Copernicus Publications follow the math typesetting regulations
%%% given by the IUPAC Green Book (IUPAC: Quantities, Units and Symbols in Physical Chemistry,
%%% 2nd Edn., Blackwell Science, available at: http://old.iupac.org/publications/books/gbook/green_book_2ed.pdf, 1993).
%%%
%%% Physical quantities/variables are typeset in italic font (t for time, T for Temperature)
%%% Indices which are not defined are typeset in italic font (x, y, z, a, b, c)
%%% Items/objects which are defined are typeset in roman font (Car A, Car B)
%%% Descriptions/specifications which are defined by itself are typeset in roman font (abs, rel, ref, tot, net, ice)
%%% Abbreviations from 2 letters are typeset in roman font (RH, LAI)
%%% Vectors are identified in bold italic font using \vec{x}
%%% Matrices are identified in bold roman font
%%% Multiplication signs are typeset using the LaTeX commands \times (for vector products, grids, and exponential notations) or \cdot
%%% The character * should not be applied as mutliplication sign
%
%
%%% EQUATIONS
%
%%% Single-row equation
%
%\begin{equation}
%
%\end{equation}
%
%%% Multiline equation
%
%\begin{align}
%& 3 + 5 = 8\\
%& 3 + 5 = 8\\
%& 3 + 5 = 8
%\end{align}
%
%
%%% MATRICES
%
%\begin{matrix}
%x & y & z\\
%x & y & z\\
%x & y & z\\
%\end{matrix}
%
%
%%% ALGORITHM
%
%\begin{algorithm}
%\caption{...}
%\label{a1}
%\begin{algorithmic}
%...
%\end{algorithmic}
%\end{algorithm}
%
%
%%% CHEMICAL FORMULAS AND REACTIONS
%
%%% For formulas embedded in the text, please use \chem{}
%
%%% The reaction environment creates labels including the letter R, i.e. (R1), (R2), etc.
%
%\begin{reaction}
%%% \rightarrow should be used for normal (one-way) chemical reactions
%%% \rightleftharpoons should be used for equilibria
%%% \leftrightarrow should be used for resonance structures
%\end{reaction}
%
%
%%% PHYSICAL UNITS
%%%
%%% Please use \unit{} and apply the exponential notation


\end{document}
